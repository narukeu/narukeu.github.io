<!DOCTYPE html>
<html lang="zh-Hans" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基础设施-业务功能设计文档 | Luke Na's Docs</title>
    <meta name="description" content="Web 文章、资料、代码片段等内容">
    <meta name="generator" content="VitePress v2.0.0-alpha.12">
    <link rel="preload stylesheet" href="/assets/style.DruoqU4u.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.hAw52G0L.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.aOfyCkKj.js">
    <link rel="modulepreload" href="/assets/chunks/framework.lo-SgHyK.js">
    <link rel="modulepreload" href="/assets/design-doc_ripple.md.DbiwPYwA.lean.js">
    <link rel="icon" href="/favicon.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-ecd09619><!--[--><!--]--><!--[--><span tabindex="-1" data-v-f7052d3b></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-f7052d3b>Skip to content</a><!--]--><!----><header class="VPNav" data-v-ecd09619 data-v-9862a508><div class="VPNavBar" data-v-9862a508 data-v-a036aacc><div class="wrapper" data-v-a036aacc><div class="container" data-v-a036aacc><div class="title" data-v-a036aacc><div class="VPNavBarTitle has-sidebar" data-v-a036aacc data-v-e9396610><a class="title" href="/" data-v-e9396610><!--[--><!--]--><!----><span data-v-e9396610>Luke Na&#39;s Docs</span><!--[--><!--]--></a></div></div><div class="content" data-v-a036aacc><div class="content-body" data-v-a036aacc><!--[--><!--]--><div class="VPNavBarSearch search" data-v-a036aacc><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a036aacc data-v-a84596d2><span id="main-nav-aria-label" class="visually-hidden" data-v-a84596d2> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-a84596d2 data-v-ead08302><!--[--><span data-v-ead08302>主页</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a036aacc data-v-cfd1510d><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-cfd1510d data-v-bd3c1a51 data-v-8f367072><span class="check" data-v-8f367072><span class="icon" data-v-8f367072><!--[--><span class="vpi-sun sun" data-v-bd3c1a51></span><span class="vpi-moon moon" data-v-bd3c1a51></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a036aacc data-v-9f8ec710 data-v-93f3f618><!--[--><a class="VPSocialLink no-icon" href="https://github.com/narukeu" aria-label="github" target="_blank" rel="me noopener" data-v-93f3f618 data-v-0596cbc3><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a036aacc data-v-d0a6dac3 data-v-b0156ee2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b0156ee2><span class="vpi-more-horizontal icon" data-v-b0156ee2></span></button><div class="menu" data-v-b0156ee2><div class="VPMenu" data-v-b0156ee2 data-v-72472372><!----><!--[--><!--[--><!----><div class="group" data-v-d0a6dac3><div class="item appearance" data-v-d0a6dac3><p class="label" data-v-d0a6dac3>Appearance</p><div class="appearance-action" data-v-d0a6dac3><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-d0a6dac3 data-v-bd3c1a51 data-v-8f367072><span class="check" data-v-8f367072><span class="icon" data-v-8f367072><!--[--><span class="vpi-sun sun" data-v-bd3c1a51></span><span class="vpi-moon moon" data-v-bd3c1a51></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0a6dac3><div class="item social-links" data-v-d0a6dac3><div class="VPSocialLinks social-links-list" data-v-d0a6dac3 data-v-93f3f618><!--[--><a class="VPSocialLink no-icon" href="https://github.com/narukeu" aria-label="github" target="_blank" rel="me noopener" data-v-93f3f618 data-v-0596cbc3><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a036aacc data-v-f9fd6b90><span class="container" data-v-f9fd6b90><span class="top" data-v-f9fd6b90></span><span class="middle" data-v-f9fd6b90></span><span class="bottom" data-v-f9fd6b90></span></span></button></div></div></div></div><div class="divider" data-v-a036aacc><div class="divider-line" data-v-a036aacc></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-ecd09619 data-v-a417cc13><div class="container" data-v-a417cc13><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a417cc13><span class="vpi-align-left menu-icon" data-v-a417cc13></span><span class="menu-text" data-v-a417cc13>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a417cc13 data-v-0a86b8e5><button data-v-0a86b8e5>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-ecd09619 data-v-06100c94><div class="curtain" data-v-06100c94></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-06100c94><span class="visually-hidden" id="sidebar-aria-label" data-v-06100c94> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-45c21dcd><section class="VPSidebarItem level-0" data-v-45c21dcd data-v-f326af2d><div class="item" role="button" tabindex="0" data-v-f326af2d><div class="indicator" data-v-f326af2d></div><h2 class="text" data-v-f326af2d>简介</h2><!----></div><div class="items" data-v-f326af2d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-f326af2d data-v-f326af2d><div class="item" data-v-f326af2d><div class="indicator" data-v-f326af2d></div><a class="VPLink link link" href="/design-doc.html" data-v-f326af2d><!--[--><p class="text" data-v-f326af2d>设计文档</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-45c21dcd><section class="VPSidebarItem level-0 has-active" data-v-45c21dcd data-v-f326af2d><div class="item" role="button" tabindex="0" data-v-f326af2d><div class="indicator" data-v-f326af2d></div><h2 class="text" data-v-f326af2d>Go</h2><!----></div><div class="items" data-v-f326af2d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-f326af2d data-v-f326af2d><div class="item" data-v-f326af2d><div class="indicator" data-v-f326af2d></div><a class="VPLink link link" href="/design-doc/ripple.html" data-v-f326af2d><!--[--><p class="text" data-v-f326af2d>基础设施设计文档</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-ecd09619 data-v-82bea445><div class="VPDoc has-sidebar has-aside" data-v-82bea445 data-v-d9c38dcc><!--[--><!--]--><div class="container" data-v-d9c38dcc><div class="aside" data-v-d9c38dcc><div class="aside-curtain" data-v-d9c38dcc></div><div class="aside-container" data-v-d9c38dcc><div class="aside-content" data-v-d9c38dcc><div class="VPDocAside" data-v-d9c38dcc data-v-4b4c377a><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-4b4c377a data-v-2ea41e1b><div class="content" data-v-2ea41e1b><div class="outline-marker" data-v-2ea41e1b></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-2ea41e1b>On this page</div><ul class="VPDocOutlineItem root" data-v-2ea41e1b data-v-c302e66c><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-4b4c377a></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d9c38dcc><div class="content-container" data-v-d9c38dcc><!--[--><!--]--><main class="main" data-v-d9c38dcc><div style="position:relative;" class="vp-doc _design-doc_ripple" data-v-d9c38dcc><div><h1 id="基础设施-业务功能设计文档" tabindex="-1">基础设施-业务功能设计文档 <a class="header-anchor" href="#基础设施-业务功能设计文档" aria-label="Permalink to “基础设施-业务功能设计文档”">​</a></h1><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>由于后端主要使用 <code>PostgreSQL</code> 作为数据库，字段类型均以 <code>PostgreSQL</code> 为准。</p><p>如无特别说明，本设计文档仅补充 Ripple 特有的约定和差异；通用部分（接口规范、审计字段、错误码、分页与查询模式等）均以 <a href="/articles/backend-rules.html">《后端项目开发规范（通用）》</a> 为准，此处不再展开。</p></div><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>本文中如未特别说明：</p><ul><li><strong>数据表结构</strong>中的字段名统一采用 <code>snake_case</code>（对应 PostgreSQL 列名）；</li><li><strong>接口入参 / 出参（包括“筛选字段”）</strong>统一指 JSON 字段名，采用小驼峰（<code>camelCase</code>）命名，例如：数据库字段 <code>nick_name</code> 对应 JSON 字段 <code>nickName</code>，<code>created_time</code> 对应 <code>createdTime</code>。 在描述查询条件、筛选字段等场景时，除非明确说明“数据库字段”，一律以 JSON 字段名为准。</li><li><strong>项目统一使用</strong> <code>Request</code> 和 <code>Response</code> 来分别表示接口入参和出参的数据传输对象（DTO）和视图对象（VO）。</li></ul></div><h2 id="_0-总体" tabindex="-1">0. 总体 <a class="header-anchor" href="#_0-总体" aria-label="Permalink to “0. 总体”">​</a></h2><p>名为 <code>Ripple</code> 的后端基础设施，单体架构，单租户，软件包名为 <code>github.com/okutils/ripple</code>。</p><p>设计思路参考了 <code>ruoyi</code> 开源项目，同时结合项目需求进行调整。</p><h3 id="_0-1-后端技术栈" tabindex="-1">0.1 后端技术栈 <a class="header-anchor" href="#_0-1-后端技术栈" aria-label="Permalink to “0.1 后端技术栈”">​</a></h3><ul><li>Go 1.25+</li><li>Gin 框架：<code>github.com/gin-gonic/gin</code></li><li>GORM ORM：<code>gorm.io/gorm</code></li><li>Flyway</li><li>PostgreSQL：<code>gorm.io/driver/postgres</code></li><li>JWT：<code>github.com/golang-jwt/jwt</code></li><li>Zap：<code>go.uber.org/zap</code></li><li>Redis：<code>github.com/redis/go-redis</code></li><li>Viper：<code>github.com/spf13/viper</code></li><li>Casbin：<code>github.com/casbin/casbin/v2</code></li><li>Swaggo：<code>github.com/swaggo/swag</code></li><li>UUID：<code>github.com/google/uuid</code></li><li>Lo：<code>github.com/samber/lo</code>，Go 的实用工具库。</li><li>Gorilla WebSocket：<code>github.com/gorilla/websocket</code></li></ul><h3 id="_0-2-项目结构" tabindex="-1">0.2 项目结构 <a class="header-anchor" href="#_0-2-项目结构" aria-label="Permalink to “0.2 项目结构”">​</a></h3><p>在<a href="/articles/go-conventions.html">《Go 语言项目开发、风格和命名规范》</a>上进行细化。</p><h3 id="_0-3-公共字段" tabindex="-1">0.3 公共字段 <a class="header-anchor" href="#_0-3-公共字段" aria-label="Permalink to “0.3 公共字段”">​</a></h3><p>若非特别说明，所有数据表都应包含一组标准公共字段（主键、审计时间、操作人、状态、备注、系统保留标记等），以记录元数据。配置表、关联表等特殊表除外。字段名称、类型与约束统一遵循《后端项目开发规范（通用）》中的“公共字段规范”章节，这里只在存在差异时单独说明。</p><p>主键 UUID 在应用层，使用 <code>github.com/google/uuid</code> 生成 UUIDv7。</p><h3 id="_0-4-长连接" tabindex="-1">0.4 长连接 <a class="header-anchor" href="#_0-4-长连接" aria-label="Permalink to “0.4 长连接”">​</a></h3><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>WebSocket 是可选功能，项目启动时可通过配置文件启用或禁用。</p></div><p>用户在登录之后，（如果启用 WebSocket 功能）自动连接到后端 WebSocket 服务。WebSocket 服务也应当使用 JWT 进行鉴权。 用户在什么场合向服务端发送消息、服务端向用户发送什么消息，在具体业务模块中会讲述。</p><ul><li>鉴权与握手：优先在握手阶段通过 <code>Sec-WebSocket-Protocol: bearer, &lt;JWT&gt;</code> 传递 Token（或受控 Cookie）。不建议将 Token 放在 Query 参数。鉴权失败使用关闭码 4401/4403 并返回错误消息后关闭。</li><li>多实例：如采用多副本部署，与在线会话/推送相关的事件通过 Redis Pub/Sub 或 Stream 广播到各实例进行路由。</li></ul><h4 id="_0-4-1-发送和接收消息格式" tabindex="-1">0.4.1 发送和接收消息格式 <a class="header-anchor" href="#_0-4-1-发送和接收消息格式" aria-label="Permalink to “0.4.1 发送和接收消息格式”">​</a></h4><h5 id="_0-4-1-1-接收格式" tabindex="-1">0.4.1.1 接收格式 <a class="header-anchor" href="#_0-4-1-1-接收格式" aria-label="Permalink to “0.4.1.1 接收格式”">​</a></h5><div class="language-jsonc"><button title="Copy Code" class="copy"></button><span class="lang">jsonc</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;requestId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;action&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 动作名称，具体会在业务功能模块中定义。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;businessCode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 业务状态码：0 表示成功，非 0 表示具体错误类型。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;isSuccess&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 操作是否成功，错误时为 false。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;操作成功！&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 结果消息，错误时返回错误信息。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {}, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 返回的数据，错误时为 null。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-11-05T07:44:01.608Z&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ISO 8601 格式的时间戳。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;errors&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 可选，详细错误信息列表，用于复杂业务错误场景。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h5 id="_0-4-1-2-发送格式" tabindex="-1">0.4.1.2 发送格式 <a class="header-anchor" href="#_0-4-1-2-发送格式" aria-label="Permalink to “0.4.1.2 发送格式”">​</a></h5><div class="language-jsonc"><button title="Copy Code" class="copy"></button><span class="lang">jsonc</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;requestId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;action&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 动作名称，具体会在业务功能模块中定义。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;payload&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {} </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 发送的数据负载。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="_0-4-2-心跳和重连" tabindex="-1">0.4.2 心跳和重连 <a class="header-anchor" href="#_0-4-2-心跳和重连" aria-label="Permalink to “0.4.2 心跳和重连”">​</a></h4><ul><li>客户端每隔 30 秒发送一次心跳消息，格式同发送格式，<code>action</code> 字段为 <code>heartbeat</code>，<code>payload</code> 为空对象 <code>{}</code>。</li><li>有三次重试机会，采取指数退避策略，初始间隔 1 秒，每次失败后间隔翻倍。</li><li>Token 过期策略：到期断开，前端获取新 Token 后重连（简化方案）。</li></ul><h3 id="_0-5-字典引用字段统一约定" tabindex="-1">0.5 字典引用字段统一约定 <a class="header-anchor" href="#_0-5-字典引用字段统一约定" aria-label="Permalink to “0.5 字典引用字段统一约定”">​</a></h3><p>为与“字典值既可为数字也可为字符串”的规则保持一致，统一约定如下：</p><ul><li>所有引用字典值的业务字段一律使用 <code>VARCHAR(32)</code> 存储，对应字典表中的 <code>value</code>；若 <code>value</code> 为数字，则以字符串形式存储。</li><li>接口入参与出参均使用字符串表达字典值；需要数值语义的场景由服务端在业务层进行解析/转换。</li><li>示例字段：公共字段 <code>status</code>、菜单 <code>type</code>、公告 <code>importance</code> 等。</li><li>该约定可避免跨表强类型耦合，便于后续对字典取值形态（数值/字符串）的演进。</li></ul><h3 id="_0-6-配置文件" tabindex="-1">0.6 配置文件 <a class="header-anchor" href="#_0-6-配置文件" aria-label="Permalink to “0.6 配置文件”">​</a></h3><p>使用 Viper 进行配置管理，支持多环境配置文件（<code>config.development.yaml</code>、<code>config.production.yaml</code> 等），以及环境变量覆盖。</p><p>配置文件包含以下主要部分：</p><ul><li><code>server</code>：服务器相关配置，如端口号、运行模式等。</li><li><code>database</code>：数据库连接配置，如主机、端口、用户名、密码、数据库名等。</li><li><code>redis</code>： Redis 连接配置。</li><li><code>jwt</code>：JWT 相关配置，如密钥、过期时间等。</li><li><code>logging</code>：日志相关配置，如日志级别、输出路径等。</li><li><code>websocket</code>：WebSocket 相关配置，如心跳间隔、最大连接数等。</li></ul><h3 id="_0-7-其他" tabindex="-1">0.7 其他 <a class="header-anchor" href="#_0-7-其他" aria-label="Permalink to “0.7 其他”">​</a></h3><ul><li>对于每一个控制器和服务，应当都编写接口定义（Interface）</li><li>对于每一个控制器和服务，应当都编写 <code>NewXxx</code> 的构造函数。</li><li>Gin 框架的核心对象必须使用描述性强的名称，严禁使用单字母或模糊缩写。如 <code>func (ginContext *gin.Context) { ... }</code>、<code>func (ginEngine *gin.Engine) { ... }</code>。</li></ul><h2 id="_1-用户模块" tabindex="-1">1. 用户模块 <a class="header-anchor" href="#_1-用户模块" aria-label="Permalink to “1. 用户模块”">​</a></h2><p>用户模块其实是系统模块的一部分，但由于其重要性和复杂性，单独成章进行设计说明。</p><p>但是在后端代码库里面，用户模块其实是放在系统模块下的。</p><p>在路由上，前端部分用户路由单独注册，但是后端部分，和系统模块一致，都是在 <code>/system</code> 下注册。</p><h3 id="_1-1-用户管理" tabindex="-1">1.1 用户管理 <a class="header-anchor" href="#_1-1-用户管理" aria-label="Permalink to “1.1 用户管理”">​</a></h3><h4 id="_1-1-1-用户表设计" tabindex="-1">1.1.1 用户表设计 <a class="header-anchor" href="#_1-1-1-用户表设计" aria-label="Permalink to “1.1.1 用户表设计”">​</a></h4><table tabindex="0"><thead><tr><th>字段名</th><th>类型</th><th>描述</th><th>备注</th><th>索引</th><th>可选</th><th>是否唯一</th><th>默认值</th></tr></thead><tbody><tr><td>name</td><td>VARCHAR(64)</td><td>用户名</td><td>应当是英文字母</td><td>是</td><td></td><td>是</td><td></td></tr><tr><td>nick_name</td><td>VARCHAR(128)</td><td>昵称</td><td>若不填，前端则显示 <code>name</code></td><td></td><td>是</td><td>否</td><td></td></tr><tr><td>real_name</td><td>VARCHAR(128)</td><td>真实姓名</td><td></td><td></td><td>是</td><td>否</td><td></td></tr><tr><td>email</td><td>VARCHAR(256)</td><td>邮箱地址</td><td>建议大小写不敏感唯一</td><td>是</td><td>是</td><td>是</td><td></td></tr><tr><td>phone</td><td>VARCHAR(64)</td><td>手机号码</td><td>必须是字符串（建议使用 E.164 规范）</td><td>是</td><td>是</td><td>是</td><td></td></tr><tr><td>password</td><td>VARCHAR(1024)</td><td>密码</td><td>必须加盐（argon2id），存储哈希</td><td></td><td></td><td>否</td><td></td></tr><tr><td>avatar_url</td><td>TEXT</td><td>头像地址</td><td>可以是 URL，也可以是在对象存储中的标识符，越长越好，所以类型 <code>TEXT</code></td><td></td><td>是</td><td>否</td><td></td></tr></tbody></table><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><ul><li>唯一性与软删除：<code>name</code>、<code>email</code>、<code>phone</code> 的唯一性仅对未删除记录生效（<code>deleted_time IS NULL</code> 的部分唯一索引）。<code>name</code>/<code>email</code> 建议使用不区分大小写唯一（如对 <code>LOWER(name)</code>、<code>LOWER(email)</code> 建唯一索引）。</li><li>安全：密码必须使用 <code>argon2id</code>（存储为标准编码串 <code>$argon2id$...</code>），建议参数：内存 64–128MB、迭代 1–3、并行度 1–4。初始化/重置密码后建议强制用户首次登录修改（见业务规则）。</li></ul></div><h5 id="_1-1-1-1-request-字段" tabindex="-1">1.1.1.1 Request 字段 <a class="header-anchor" href="#_1-1-1-1-request-字段" aria-label="Permalink to “1.1.1.1 Request 字段”">​</a></h5><p>Request 和 Response 作为 JSON 的时候，字段名均采用驼峰命名法（<code>camelCase</code>），以下不再赘述。</p><ul><li>实现表中所有字段</li><li>在修改表单时，Request 还需要 <code>oldPassword</code> 字段，用于验证旧密码；仅当修改密码时为必填。</li><li>接受 <code>roleIds</code> 数组字段，用于指定用户所属角色。</li><li>密码最低 12 位，前后端均需校验。</li></ul><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>后台管理员为他人重置密码不要求 <code>oldPassword</code>，但需要具备相应权限点；建议提供独立的重置密码表单/Request。</p></div><h5 id="_1-1-1-2-response-字段" tabindex="-1">1.1.1.2 Response 字段 <a class="header-anchor" href="#_1-1-1-2-response-字段" aria-label="Permalink to “1.1.1.2 Response 字段”">​</a></h5><ul><li>实现 Request 中所有字段，<strong>但不包含密码字段</strong>。</li></ul><h4 id="_1-1-2-用户状态" tabindex="-1">1.1.2 用户状态 <a class="header-anchor" href="#_1-1-2-用户状态" aria-label="Permalink to “1.1.2 用户状态”">​</a></h4><p>和公共字段中的 <code>status</code> 字段一致。</p><h4 id="_1-1-3-关联" tabindex="-1">1.1.3 关联 <a class="header-anchor" href="#_1-1-3-关联" aria-label="Permalink to “1.1.3 关联”">​</a></h4><ol><li>和角色关联，多对多关系，通过关联表实现。</li><li>和部门关联，多对多关系，一个用户可以属于多个部门，一个部门也可以有多个用户，通过关联表实现。</li></ol><h4 id="_1-1-4-接口" tabindex="-1">1.1.4 接口 <a class="header-anchor" href="#_1-1-4-接口" aria-label="Permalink to “1.1.4 接口”">​</a></h4><p>接口集合与行为遵循《后端项目开发规范（通用）》中定义的“标准 CRUD 接口”和“当前用户相关接口”约定（<code>findAll</code> 接口为可选，此处不强制要求实现）：</p><ul><li>基础接口：<code>findOne</code>、<code>findList</code>、<code>create</code>、<code>createMany</code>、<code>update</code>、<code>delete</code>、<code>deleteMany</code>、<code>remove</code>、<code>removeMany</code>、<code>restore</code>、<code>restoreMany</code>、<code>count</code>、<code>findOnlyDeleted</code></li><li>当前用户接口：<code>findMy</code>（查询自己的资料）、<code>updateMy</code>（修改自己的资料）。</li></ul><p>入参结构、分页规则、错误处理与返回格式不在本节重复，统一参考通用规范。</p><h4 id="_1-1-5-初始化数据" tabindex="-1">1.1.5 初始化数据 <a class="header-anchor" href="#_1-1-5-初始化数据" aria-label="Permalink to “1.1.5 初始化数据”">​</a></h4><table tabindex="0"><thead><tr><th>用户 ID</th><th>用户名</th><th>密码</th><th>角色</th><th>系统保留用户</th></tr></thead><tbody><tr><td>随机生成</td><td><code>root</code></td><td>部署时生成随机强密码</td><td><code>超级管理员</code>,<code>管理员</code>,<code>用户</code></td><td>是</td></tr><tr><td>随机生成</td><td><code>guest</code></td><td>部署时生成随机强密码</td><td><code>游客</code></td><td>是</td></tr></tbody></table><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><ul><li>初始化密码不在文档中以明文展示；部署阶段生成一次性强密码并要求首次登录修改。</li><li><code>guest</code> 保留用户禁止手动登录（见登录规则），仅用于匿名访问场景，由系统在中间件中注入，不参与常规登录流程，其用户 UUID 在系统初始化时固定。</li></ul></div><h4 id="_1-1-6-业务规则" tabindex="-1">1.1.6 业务规则 <a class="header-anchor" href="#_1-1-6-业务规则" aria-label="Permalink to “1.1.6 业务规则”">​</a></h4><h5 id="_1-1-6-1-创建-修改逻辑" tabindex="-1">1.1.6.1 创建/修改逻辑 <a class="header-anchor" href="#_1-1-6-1-创建-修改逻辑" aria-label="Permalink to “1.1.6.1 创建/修改逻辑”">​</a></h5><h6 id="_1-1-6-1-1-后台管理面板的用户管理表单" tabindex="-1">1.1.6.1.1 后台管理面板的用户管理表单 <a class="header-anchor" href="#_1-1-6-1-1-后台管理面板的用户管理表单" aria-label="Permalink to “1.1.6.1.1 后台管理面板的用户管理表单”">​</a></h6><ul><li>创建/修改时，用户可以选择和修改所属角色，前端角色字段为多选框。</li><li>用户在创建时必须设置符合密码策略的密码（长度、复杂度等统一遵循通用规范和本节“密码规则”约定）。</li><li>管理员修改他人资料时允许不修改密码；如需重置密码，不要求旧密码，但必须具备相应权限点并记录审计日志（审计字段与日志规范参考通用规范）。</li></ul><h6 id="_1-1-6-1-2-用户修改自己资料-updatemy" tabindex="-1">1.1.6.1.2 用户修改自己资料（updateMy） <a class="header-anchor" href="#_1-1-6-1-2-用户修改自己资料-updatemy" aria-label="Permalink to “1.1.6.1.2 用户修改自己资料（updateMy）”">​</a></h6><ul><li>字段和后台用户管理表单相同，但不允许修改自己的角色。</li><li>用户在修改资料时，非敏感字段（如昵称、头像、邮箱、手机号等）的修改不需要旧密码。</li><li>用户如选择修改密码，则必须提供 <code>oldPassword</code> 进行验证，否则报错；密码强度校验与登录模块的密码规则保持一致。</li></ul><h5 id="_1-1-6-2-权限规则" tabindex="-1">1.1.6.2 权限规则 <a class="header-anchor" href="#_1-1-6-2-权限规则" aria-label="Permalink to “1.1.6.2 权限规则”">​</a></h5><ul><li>普通用户只能查询和修改自己的资料，不能查询其他用户的信息，因此，用户管理的 <code>findOne</code> 等管理接口默认不向普通用户授予 CRUD 权限，权限由菜单/角色配置决定。</li><li>管理员用户和超级管理员用户可以查询和修改所有用户的信息，仍通过菜单里的权限赋予实现，具体权限点命名与 <code>system_api_perm.code</code> 规则保持一致（菜单通过 <code>permission_code_id</code> 关联权限点）。</li><li>如果一个接口没有绑定权限点，一律抛出错误，提示接口配置有误。</li><li>上述权限不要通过业务代码硬编码，统一交由 RBAC + 菜单权限体系（见“鉴权”章节）控制。</li></ul><h5 id="_1-1-6-3-删除逻辑" tabindex="-1">1.1.6.3 删除逻辑 <a class="header-anchor" href="#_1-1-6-3-删除逻辑" aria-label="Permalink to “1.1.6.3 删除逻辑”">​</a></h5><ul><li>删除用户前应检查是否有重要的关联数据，若有则阻止删除操作并返回错误信息。</li><li>其他检查： <ul><li>若该用户为某部门 <code>leader_id</code>，需先转移负责人或置空后再删除。</li><li>与角色、部门的关联应在事务中安全解关联。</li><li>系统保留用户（如 <code>root</code>、<code>guest</code>）不可删除。</li></ul></li></ul><h5 id="_1-1-6-4-查询逻辑" tabindex="-1">1.1.6.4 查询逻辑 <a class="header-anchor" href="#_1-1-6-4-查询逻辑" aria-label="Permalink to “1.1.6.4 查询逻辑”">​</a></h5><p>用户列表的查询模式遵循通用规范的“列表筛选与分页”规则，Ripple 仅补充本模块特有的筛选字段：</p><ul><li>支持模糊查询：<code>name</code>、<code>nickName</code>、<code>realName</code>、<code>email</code>、<code>phone</code>；</li><li>精确查询：<code>status</code>、<code>isSystemReserved</code>；</li><li>多选条件：<code>roleIds</code>（至少包含其中任一角色）、<code>deptIds</code>（属于其中任一部门）；</li><li>时间范围：<code>createdTime</code>（开始-结束）。</li></ul><p>组合规则与通用规范一致：除 <code>roleIds</code> 与 <code>deptIds</code> 在各自集合内使用 OR 逻辑外，不同字段间采用 AND 组合。</p><h3 id="_1-2-角色" tabindex="-1">1.2 角色 <a class="header-anchor" href="#_1-2-角色" aria-label="Permalink to “1.2 角色”">​</a></h3><h4 id="_1-2-1-角色表设计" tabindex="-1">1.2.1 角色表设计 <a class="header-anchor" href="#_1-2-1-角色表设计" aria-label="Permalink to “1.2.1 角色表设计”">​</a></h4><table tabindex="0"><thead><tr><th>字段名</th><th>类型</th><th>描述</th><th>备注</th><th>索引</th><th>可选</th><th>是否唯一</th><th>默认值</th></tr></thead><tbody><tr><td>name</td><td>VARCHAR(64)</td><td>角色名</td><td></td><td></td><td></td><td>是</td><td></td></tr><tr><td>code</td><td>VARCHAR(64)</td><td>角色编码</td><td></td><td></td><td></td><td>是</td><td></td></tr></tbody></table><h5 id="_1-2-1-1-request-字段" tabindex="-1">1.2.1.1 Request 字段 <a class="header-anchor" href="#_1-2-1-1-request-字段" aria-label="Permalink to “1.2.1.1 Request 字段”">​</a></h5><ul><li>实现表中所有字段</li><li>接受 <code>userIds</code> 数组字段，用于指定角色所属用户。</li><li>接受 <code>menuIds</code> 数组字段，用于指定角色拥有的菜单权限。</li></ul><h5 id="_1-2-1-2-response-字段" tabindex="-1">1.2.1.2 Response 字段 <a class="header-anchor" href="#_1-2-1-2-response-字段" aria-label="Permalink to “1.2.1.2 Response 字段”">​</a></h5><ul><li>实现 Request 中所有字段。</li></ul><h4 id="_1-2-2-关联" tabindex="-1">1.2.2 关联 <a class="header-anchor" href="#_1-2-2-关联" aria-label="Permalink to “1.2.2 关联”">​</a></h4><ol><li>和用户关联，多对多关系，通过关联表实现。</li><li>和菜单关联，多对多关系，通过关联表实现，实现角色权限控制。</li></ol><h4 id="_1-2-3-接口" tabindex="-1">1.2.3 接口 <a class="header-anchor" href="#_1-2-3-接口" aria-label="Permalink to “1.2.3 接口”">​</a></h4><p>角色模块沿用通用规范的标准接口集合：<code>findOne</code>、<code>findList</code>、<code>create</code>、<code>createMany</code>、<code>update</code>、<code>delete</code>、<code>deleteMany</code>、<code>remove</code>、<code>removeMany</code>、<code>restore</code>、<code>restoreMany</code>、<code>count</code>、<code>findOnlyDeleted</code>，参数与返回体结构不再赘述。</p><h4 id="_1-2-4-初始化数据" tabindex="-1">1.2.4 初始化数据 <a class="header-anchor" href="#_1-2-4-初始化数据" aria-label="Permalink to “1.2.4 初始化数据”">​</a></h4><table tabindex="0"><thead><tr><th>角色 ID</th><th>角色名</th><th>角色编码</th><th>是否系统保留角色</th></tr></thead><tbody><tr><td>随机生成</td><td>超级管理员</td><td><code>root</code></td><td>是</td></tr><tr><td>随机生成</td><td>管理员</td><td><code>admin</code></td><td>是</td></tr><tr><td>随机生成</td><td>用户</td><td><code>user</code></td><td>是</td></tr><tr><td>随机生成</td><td>游客</td><td><code>visitor</code></td><td>是</td></tr></tbody></table><h4 id="_1-2-5-业务规则" tabindex="-1">1.2.5 业务规则 <a class="header-anchor" href="#_1-2-5-业务规则" aria-label="Permalink to “1.2.5 业务规则”">​</a></h4><ul><li>一个用户可以有多个角色，管理员用户必须同时具有 <code>admin</code> 和 <code>user</code> 角色，超级管理员用户必须同时具有 <code>root</code>、<code>admin</code> 和 <code>user</code> 角色。非游客用户不可被赋予游客角色。</li><li>系统保留角色（<code>root</code>、<code>admin</code>、<code>user</code>、<code>visitor</code>）不可被删除，无论是逻辑删除还是物理删除；其 <code>code</code> 不可修改。</li><li>当创建、修改（变更权限集合）、删除角色时，必须同步更新 Casbin 的策略存储（Policy Storage）。具体表现为：先清除该角色在 Casbin 中旧的 p (policy) 策略，再根据新的 menuIds 查出对应的 <code>permission_code_id</code>，联表查询 <code>system_api_perm</code> 得到权限编码 <code>code</code>，重新写入 Casbin 规则。</li></ul><h5 id="_1-2-5-1-查询逻辑" tabindex="-1">1.2.5.1 查询逻辑 <a class="header-anchor" href="#_1-2-5-1-查询逻辑" aria-label="Permalink to “1.2.5.1 查询逻辑”">​</a></h5><p>角色列表查询参数及分页行为遵循通用规范，仅补充本模块特有筛选字段与含义：</p><ul><li>模糊查询：<code>name</code>、<code>code</code>；</li><li>精确查询：<code>status</code>、<code>is_system_reserved</code>；</li><li>多选：<code>userIds</code>（至少关联其中任一用户的角色）、<code>menuIds</code>（至少包含其中任一菜单权限的角色）；</li><li>时间范围：<code>createdTime</code>（开始-结束）。</li></ul><p>字段之间默认 AND 组合，<code>userIds</code> 与 <code>menuIds</code> 的多选条件在各自集合内采用 OR 逻辑，与其他模块保持一致。</p><h2 id="_2-系统模块" tabindex="-1">2. 系统模块 <a class="header-anchor" href="#_2-系统模块" aria-label="Permalink to “2. 系统模块”">​</a></h2><h3 id="_2-1-菜单管理" tabindex="-1">2.1 菜单管理 <a class="header-anchor" href="#_2-1-菜单管理" aria-label="Permalink to “2.1 菜单管理”">​</a></h3><p>若非特别说明，这里指的是 PC 管理端菜单。 日后可能会扩展移动端、或者是其他环境的菜单，届时可另行设计数据表。</p><h4 id="_2-1-1-菜单表设计" tabindex="-1">2.1.1 菜单表设计 <a class="header-anchor" href="#_2-1-1-菜单表设计" aria-label="Permalink to “2.1.1 菜单表设计”">​</a></h4><ul><li>树表实现，使用闭包表。</li></ul><table tabindex="0"><thead><tr><th>字段名</th><th>类型</th><th>描述</th><th>备注</th><th>索引</th><th>可选</th><th>是否唯一</th><th>默认值</th></tr></thead><tbody><tr><td>name</td><td>VARCHAR(128)</td><td>菜单名称</td><td></td><td></td><td></td><td>否</td><td></td></tr><tr><td>code</td><td>VARCHAR(64)</td><td>菜单编码</td><td></td><td>是</td><td></td><td>是</td><td></td></tr><tr><td>route</td><td>VARCHAR(256)</td><td>菜单路径</td><td>前端路由</td><td></td><td>是</td><td>否</td><td></td></tr><tr><td>icon</td><td>VARCHAR(256)</td><td>菜单图标</td><td></td><td></td><td>是</td><td>否</td><td></td></tr><tr><td>sort</td><td>INTEGER</td><td>排序</td><td></td><td>是</td><td></td><td>否</td><td><code>0</code></td></tr><tr><td>parent_id</td><td>UUID</td><td>父级菜单</td><td></td><td>是</td><td>是</td><td>否</td><td><code>NULL</code></td></tr><tr><td>permission_code_id</td><td>UUID</td><td>权限点 ID</td><td>逻辑外键，引用 <code>system_api_perm</code> 主键</td><td>是</td><td>是</td><td>否</td><td></td></tr><tr><td>type</td><td>VARCHAR(32)</td><td>菜单类型</td><td>取自字典 MENU_TYPE</td><td></td><td></td><td>否</td><td></td></tr><tr><td>is_refresh</td><td>BOOLEAN</td><td>是否需要刷新</td><td></td><td></td><td>是</td><td>否</td><td><code>false</code></td></tr><tr><td>is_href</td><td>BOOLEAN</td><td>是否为外链</td><td>是的话新窗口打开</td><td></td><td>是</td><td>否</td><td><code>false</code></td></tr></tbody></table><ul><li><code>type</code> 字段用于区分菜单类型，例如目录、菜单项、按钮等，它的值详见字典初始化数据。</li></ul><h5 id="_2-1-1-1-request-字段" tabindex="-1">2.1.1.1 Request 字段 <a class="header-anchor" href="#_2-1-1-1-request-字段" aria-label="Permalink to “2.1.1.1 Request 字段”">​</a></h5><ul><li>实现表中所有字段</li><li>接受 <code>roleIds</code> 数组字段，用于指定菜单所属角色。</li><li>前端需要提交 <code>parentId</code> 字段，以构建树形结构。</li></ul><h5 id="_2-1-1-2-response-字段" tabindex="-1">2.1.1.2 Response 字段 <a class="header-anchor" href="#_2-1-1-2-response-字段" aria-label="Permalink to “2.1.1.2 Response 字段”">​</a></h5><ul><li>实现 Request 中所有字段，另外查询的时候要有 <code>children</code>。</li></ul><h4 id="_2-1-2-关联" tabindex="-1">2.1.2 关联 <a class="header-anchor" href="#_2-1-2-关联" aria-label="Permalink to “2.1.2 关联”">​</a></h4><ol><li>和角色关联，多对多关系，通过关联表实现，实现角色权限控制。</li></ol><h4 id="_2-1-3-接口" tabindex="-1">2.1.3 接口 <a class="header-anchor" href="#_2-1-3-接口" aria-label="Permalink to “2.1.3 接口”">​</a></h4><p>菜单模块在标准 CRUD 接口基础上，增加树查询能力：</p><ul><li>基础接口：<code>findOne</code>、<code>findList</code>、<code>create</code>、<code>createMany</code>、<code>update</code>、<code>delete</code>、<code>deleteMany</code>、<code>remove</code>、<code>removeMany</code>、<code>restore</code>、<code>restoreMany</code>、<code>count</code>、<code>findOnlyDeleted</code>；</li><li>树接口：<code>findTree</code>、<code>findTreeAll</code>，其入参与树形返回结构遵循通用规范中的树接口约定。</li></ul><h5 id="_2-1-3-1-创建-修改逻辑" tabindex="-1">2.1.3.1 创建/修改逻辑 <a class="header-anchor" href="#_2-1-3-1-创建-修改逻辑" aria-label="Permalink to “2.1.3.1 创建/修改逻辑”">​</a></h5><ul><li>菜单的 <code>type</code> 字段用于区分菜单类型，例如目录、菜单项、按钮（又作接口）等。</li><li>创建/修改菜单时，前端应根据 <code>type</code> 字段动态调整表单项。例如，若 <code>type</code> 为目录，则不显示 <code>route</code> 字段。</li><li>菜单不再直接存储权限编码字符串，而是通过 <code>permission_code_id</code> 关联到 <code>system_api_perm</code>，由后者提供唯一的 <code>code</code> 字段；前端展示或调试时如需显示权限码，应通过关联查询 <code>system_api_perm.code</code>。</li><li>若修改了菜单绑定的 <code>permission_code_id</code>，必须同步更新 Casbin 中所有引用旧权限码的策略记录（通过 <code>system_api_perm</code> 映射出旧/新 <code>code</code>），确保鉴权规则与元数据保持一致。</li><li>创建/修改菜单时，若指定了 <code>parent_id</code>，则必须验证该父级菜单是否存在，且不能是当前菜单本身或其子菜单，以防止循环引用。</li><li>菜单的排序字段 <code>sort</code> 应允许用户自定义，以控制菜单在前端的显示顺序。默认值为 <code>0</code>，数值越小，排序越靠前。</li><li>用户在创建/修改菜单时，可以选择该菜单所属的角色，实现权限控制。</li><li>闭包表维护：节点移动（变更 <code>parent_id</code>）需在事务中同步更新闭包关系（保留自反关系 <code>depth=0</code>）。</li></ul><h5 id="_2-1-3-2-查询逻辑" tabindex="-1">2.1.3.2 查询逻辑 <a class="header-anchor" href="#_2-1-3-2-查询逻辑" aria-label="Permalink to “2.1.3.2 查询逻辑”">​</a></h5><p>菜单列表与树查询遵循通用规范的筛选与分页模式，Ripple 增补以下特定字段与树行为说明：</p><ul><li><p>筛选字段：</p><ul><li>模糊查询：<code>name</code>、<code>code</code>；</li><li>精确查询：<code>type</code>、<code>status</code>、<code>permission_code_id</code>（按绑定权限点筛选）。</li></ul></li><li><p>树查询：在应用筛选条件后以树结构返回。当 <code>parent_id</code> 作为查询参数时，返回以该菜单为根节点的完整子树；树接口通常不分页，如需分页仅对根层节点分页，子孙节点全量展开（与部门、字典模块的树接口保持一致）。</p></li></ul><h4 id="_2-1-4-初始化数据" tabindex="-1">2.1.4 初始化数据 <a class="header-anchor" href="#_2-1-4-初始化数据" aria-label="Permalink to “2.1.4 初始化数据”">​</a></h4><p>这里的菜单数据在文档中不包含按钮级别，但在实际项目中应当包含按钮级别的权限点。</p><table tabindex="0"><thead><tr><th>菜单 ID</th><th>菜单名称</th><th>菜单编码</th><th>菜单路径</th><th>绑定权限点（示意）</th><th>图标</th><th>排序</th><th>父级菜单</th><th>初始化赋予的角色</th></tr></thead><tbody><tr><td>随机生成</td><td>仪表盘</td><td>dashboard</td><td>/dashboard</td><td>→ 对应某条 <code>system_api_perm</code> 记录</td><td></td><td>0</td><td></td><td>root, admin, user</td></tr><tr><td>随机生成</td><td>用户管理</td><td>dashboard_user</td><td>/dashboard/user</td><td>→ 对应某条 <code>system_api_perm</code> 记录</td><td></td><td>10000</td><td>仪表盘</td><td>root, admin</td></tr><tr><td>随机生成</td><td>用户列表</td><td>dashboard_user_manage</td><td>/dashboard/user/manage</td><td>→ 对应某条 <code>system_api_perm</code> 记录</td><td></td><td>10100</td><td>用户管理</td><td>root, admin</td></tr><tr><td>随机生成</td><td>角色列表</td><td>dashboard_user_role</td><td>/dashboard/role/manage</td><td>→ 对应某条 <code>system_api_perm</code> 记录</td><td></td><td>10200</td><td>用户管理</td><td>root, admin</td></tr><tr><td>随机生成</td><td>系统管理</td><td>dashboard_system</td><td>/dashboard/system</td><td>→ 对应某条 <code>system_api_perm</code> 记录</td><td></td><td>20000</td><td>仪表盘</td><td>root, admin</td></tr><tr><td>随机生成</td><td>菜单管理</td><td>dashboard_system_menu</td><td>/dashboard/system/menu</td><td>→ 对应某条 <code>system_api_perm</code> 记录</td><td></td><td>20100</td><td>系统管理</td><td>root, admin</td></tr><tr><td>随机生成</td><td>部门管理</td><td>dashboard_system_dept</td><td>/dashboard/system/dept</td><td>→ 对应某条 <code>system_api_perm</code> 记录</td><td></td><td>20200</td><td>系统管理</td><td>root, admin</td></tr><tr><td>随机生成</td><td>公告管理</td><td>dashboard_system_notice</td><td>/dashboard/system/notice</td><td>→ 对应某条 <code>system_api_perm</code> 记录</td><td></td><td>20300</td><td>系统管理</td><td>root, admin</td></tr><tr><td>随机生成</td><td>在线用户</td><td>dashboard_system_online</td><td>/dashboard/system/online</td><td>→ 对应某条 <code>system_api_perm</code> 记录</td><td></td><td>20400</td><td>系统管理</td><td>root, admin</td></tr></tbody></table><h4 id="_2-1-5-业务逻辑" tabindex="-1">2.1.5 业务逻辑 <a class="header-anchor" href="#_2-1-5-业务逻辑" aria-label="Permalink to “2.1.5 业务逻辑”">​</a></h4><ul><li>当一个目录下面没有内容，或者只有按钮类型的菜单时，该目录在前端不显示。</li><li>由于权限控制是基于菜单实现的，因此每一个权限点都必须对应一个菜单项，即使是按钮类型的权限点，也必须在菜单表中有对应的记录。</li><li>权限赋予不得硬编码在代码中，必须通过系统菜单和角色来实现。</li></ul><h3 id="_2-2-在线用户" tabindex="-1">2.2 在线用户 <a class="header-anchor" href="#_2-2-在线用户" aria-label="Permalink to “2.2 在线用户”">​</a></h3><p>在线用户功能用于展示当前通过登录并持有有效会话的用户列表，便于管理员实时查看系统使用情况并对存在风险的会话进行强制下线操作。</p><h4 id="_2-2-1-数据存储设计" tabindex="-1">2.2.1 数据存储设计 <a class="header-anchor" href="#_2-2-1-数据存储设计" aria-label="Permalink to “2.2.1 数据存储设计”">​</a></h4><ul><li>在线用户状态统一存储在 <code>Redis</code> 中。</li><li>每次用户登录成功后，生成一个会话编号 <code>sessionId</code>（使用 <code>UUIDv7</code>），并将会话信息写入 <code>Redis</code>： <ul><li>单个会话信息采用 Hash 或 JSON 字符串形式存储，Key 建议为：<code>ripple:auth:online:session:&lt;sessionId&gt;</code>。</li><li>用于快速按用户维度聚合的索引 Key：<code>ripple:auth:online:user:&lt;userId&gt;</code>，Value 为该用户当前有效会话 <code>sessionId</code> 集合（Set）。</li></ul></li><li>会话 Key 的 TTL 建议设置为“访问令牌有效期 + 30 秒缓冲”；当访问令牌通过刷新接口获得新令牌时，应同步按新的访问令牌有效期（同样附加 30 秒缓冲）续期对应会话 Key 的 TTL。</li><li>当访问令牌过期或用户主动退出登录时，自动从 <code>Redis</code> 中清理对应会话数据。</li></ul><p>单个在线会话记录建议包含如下字段（值以字符串形式存储）：</p><table tabindex="0"><thead><tr><th>字段名</th><th>描述</th><th>备注</th></tr></thead><tbody><tr><td>sessionId</td><td>会话编号</td><td><code>UUIDv7</code>，由系统在登录成功后生成</td></tr><tr><td>userId</td><td>用户 ID</td><td>对应用户表主键</td></tr><tr><td>userName</td><td>登录名</td><td>对应用户表中的 <code>name</code> 字段</td></tr><tr><td>ip</td><td>登录 IP 地址</td><td>从请求中解析得到</td></tr><tr><td>userAgent</td><td>User-Agent 信息</td><td>从请求头中读取，必要时可裁剪长度</td></tr><tr><td>loginTime</td><td>登录时间</td><td>ISO 8601 文本，例如 <code>2025-11-13T...</code></td></tr><tr><td>jwtId</td><td>访问令牌唯一标识</td><td>可选，用于与 JWT 的 <code>jti</code> 建立关联</td></tr></tbody></table><p>说明：</p><ul><li>若同一用户在多个终端或浏览器中登录，则会产生多条在线会话记录，每条记录拥有独立的 <code>sessionId</code>。</li><li>后续如需扩展，可在会话记录中增加地理位置、登录渠道等字段，但本期仅实现上述必要字段。</li></ul><h4 id="_2-2-2-接口" tabindex="-1">2.2.2 接口 <a class="header-anchor" href="#_2-2-2-接口" aria-label="Permalink to “2.2.2 接口”">​</a></h4><p>在线用户管理作为系统模块下的一个子功能，推荐提供以下接口（具体入参与出参格式详见《后端项目开发规范（通用）》）：</p><ul><li><code>findList</code> - 分页/条件查询在线用户列表。</li><li><code>count</code> - 查询当前在线会话总数。</li><li><code>kickOut</code> - 根据会话编号强制下线指定会话。</li></ul><p>接口均属于系统管理后台接口，仅对具有对应菜单权限的管理员/超级管理员开放，普通用户不得访问。</p><h5 id="_2-2-2-1-查询字段与返回结构" tabindex="-1">2.2.2.1 查询字段与返回结构 <a class="header-anchor" href="#_2-2-2-1-查询字段与返回结构" aria-label="Permalink to “2.2.2.1 查询字段与返回结构”">​</a></h5><p>查询接口（<code>findList</code>）支持以下筛选字段（均为 JSON 字段，采用 <code>camelCase</code>）：</p><ul><li><code>userName</code>：支持模糊查询，用于按登录名搜索在线用户。</li><li><code>ip</code>：支持精确查询或前缀匹配，用于按 IP 过滤会话。</li><li><code>userAgent</code>：支持模糊查询，用于按 UA 关键字过滤（例如移动端、浏览器类型等）。</li><li><code>loginTime</code>：范围查询（开始-结束），用于筛选某个时间段内登录的会话。</li></ul><p>组合规则：不同字段之间默认采用 AND 组合。</p><p>在线用户列表 Response 建议包含以下字段：</p><ul><li><code>sessionId</code></li><li><code>userId</code></li><li><code>userName</code></li><li><code>ip</code></li><li><code>userAgent</code></li><li><code>loginTime</code></li></ul><h5 id="_2-2-2-2-踢下线-kickout" tabindex="-1">2.2.2.2 踢下线（kickOut） <a class="header-anchor" href="#_2-2-2-2-踢下线-kickout" aria-label="Permalink to “2.2.2.2 踢下线（kickOut）”">​</a></h5><p>踢下线接口用于强制某个在线会话立即失效：</p><ul><li>入参至少包含：<code>sessionId</code>。</li><li>业务流程： <ul><li>根据 <code>sessionId</code> 从 <code>Redis</code> 查询会话记录；如不存在则视为成功。</li><li>删除会话 Key：<code>ripple:auth:online:session:&lt;sessionId&gt;</code>。</li><li>从 <code>ripple:auth:online:user:&lt;userId&gt;</code> Set 中移除对应 <code>sessionId</code>，如该用户不再有其他会话，则可选择性删除该用户 Key。</li><li>若在线会话与 JWT 的 <code>jti</code> 关联，则同时将该 <code>jti</code> 写入黑名单或标记为失效，确保剩余有效期内无法继续使用旧 Token 访问接口。</li><li>如当前会话已建立 WebSocket 连接，应通过服务端通知该连接强制断开。没有建立 WebSocket 连接的，则无需处理。</li></ul></li></ul><p>权限控制：</p><ul><li>只有具有系统管理相关菜单权限（如 <code>dashboard:system:online</code> 或其下按钮权限）的管理员和超级管理员可以调用 <code>kickOut</code> 接口。但是这个需求属于业务上的，不硬编码在代码中，而是通过菜单权限体系来实现。</li><li>普通用户不可踢其他用户下线；用户“自踢”（退出其他设备登录），应通过单独的用户模块接口实现。</li></ul><h3 id="_2-3-字典" tabindex="-1">2.3 字典 <a class="header-anchor" href="#_2-3-字典" aria-label="Permalink to “2.3 字典”">​</a></h3><h4 id="_2-3-1-字典表设计" tabindex="-1">2.3.1 字典表设计 <a class="header-anchor" href="#_2-3-1-字典表设计" aria-label="Permalink to “2.3.1 字典表设计”">​</a></h4><ul><li>树表实现，使用邻接表模型。</li></ul><table tabindex="0"><thead><tr><th>字段名</th><th>类型</th><th>描述</th><th>备注</th><th>索引</th><th>可选</th><th>是否唯一</th><th>默认值</th></tr></thead><tbody><tr><td>name</td><td>VARCHAR(128)</td><td>字典名称</td><td></td><td></td><td></td><td>否</td><td></td></tr><tr><td>code</td><td>VARCHAR(64)</td><td>字典编码</td><td>顶级类目使用（value 为空）</td><td>是</td><td></td><td>是</td><td></td></tr><tr><td>value</td><td>VARCHAR(32)</td><td>字典值</td><td></td><td>是</td><td>是</td><td>否</td><td></td></tr><tr><td>parent_id</td><td>UUID</td><td>父级字典</td><td></td><td>是</td><td>是</td><td>否</td><td><code>NULL</code></td></tr></tbody></table><ul><li>为了保证字典值的通用性，因此允许数字，也允许字符串（统一以 <code>VARCHAR(32)</code> 字符串存储）。</li><li>约束约定： <ul><li>顶级类目：<code>parent_id IS NULL AND value IS NULL</code>，<code>code</code> 唯一。</li><li>条目：<code>parent_id IS NOT NULL AND value IS NOT NULL</code>，同一父级下 <code>(parent_id, value)</code> 唯一。</li><li>唯一性仅对未删除记录生效（部分唯一索引）。</li></ul></li></ul><h5 id="_2-3-1-1-request-字段" tabindex="-1">2.3.1.1 Request 字段 <a class="header-anchor" href="#_2-3-1-1-request-字段" aria-label="Permalink to “2.3.1.1 Request 字段”">​</a></h5><ul><li>实现表中所有字段；提交数据时使用 <code>parentId</code> 指定父子关系，不包含 <code>children</code>。</li></ul><h5 id="_2-3-1-2-response-字段" tabindex="-1">2.3.1.2 Response 字段 <a class="header-anchor" href="#_2-3-1-2-response-字段" aria-label="Permalink to “2.3.1.2 Response 字段”">​</a></h5><ul><li>实现 Request 中所有字段；树查询时包含 <code>children</code>。</li></ul><h4 id="_2-3-2-接口" tabindex="-1">2.3.2 接口 <a class="header-anchor" href="#_2-3-2-接口" aria-label="Permalink to “2.3.2 接口”">​</a></h4><p>字典模块接口与菜单、部门模块类似，沿用通用规范中的标准列表/树/统计接口：<code>findOne</code>、<code>findList</code>、<code>findTree</code>、<code>findTreeAll</code>、<code>create</code>、<code>createMany</code>、<code>update</code>、<code>delete</code>、<code>deleteMany</code>、<code>remove</code>、<code>removeMany</code>、<code>restore</code>、<code>restoreMany</code>、<code>count</code>，此处不展开入参/出参细节。</p><h4 id="_2-3-3-初始化数据" tabindex="-1">2.3.3 初始化数据 <a class="header-anchor" href="#_2-3-3-初始化数据" aria-label="Permalink to “2.3.3 初始化数据”">​</a></h4><p>均为系统保留数据。</p><table tabindex="0"><thead><tr><th>字典 ID</th><th>字典名称</th><th>字典编码</th><th>字典值（字符串）</th><th>父级</th><th>备注</th></tr></thead><tbody><tr><td>随机生成</td><td>性别</td><td>GENDER</td><td></td><td></td><td>取自国家标准代码</td></tr><tr><td>随机生成</td><td>未知性别</td><td>GENDER_UNKNOWN</td><td>0</td><td>GENDER</td><td></td></tr><tr><td>随机生成</td><td>男</td><td>GENDER_MALE</td><td>1</td><td>GENDER</td><td></td></tr><tr><td>随机生成</td><td>女</td><td>GENDER_FEMALE</td><td>2</td><td>GENDER</td><td></td></tr><tr><td>随机生成</td><td>未说明的性别</td><td>GENDER_NONE</td><td>9</td><td>GENDER</td><td></td></tr><tr><td>随机生成</td><td>菜单类型</td><td>MENU_TYPE</td><td></td><td></td><td>菜单类型（目录/菜单项/按钮）</td></tr><tr><td>随机生成</td><td>目录</td><td>MENU_TYPE_DIR</td><td>0</td><td>MENU_TYPE</td><td></td></tr><tr><td>随机生成</td><td>菜单项</td><td>MENU_TYPE_MENU</td><td>1</td><td>MENU_TYPE</td><td></td></tr><tr><td>随机生成</td><td>按钮</td><td>MENU_TYPE_BUTTON</td><td>2</td><td>MENU_TYPE</td><td></td></tr><tr><td>随机生成</td><td>状态</td><td>STATUS</td><td></td><td></td><td>通用状态（无效/有效）</td></tr><tr><td>随机生成</td><td>无效</td><td>STATUS_DISABLED</td><td>0</td><td>STATUS</td><td></td></tr><tr><td>随机生成</td><td>有效</td><td>STATUS_ENABLED</td><td>1</td><td>STATUS</td><td></td></tr><tr><td>随机生成</td><td>重要程度</td><td>NOTICE_IMPORTANCE</td><td></td><td></td><td>公告重要程度（非常重要/比较重要/中等/不太重要/不重要）</td></tr><tr><td>随机生成</td><td>非常重要</td><td>NOTICE_IMPORTANCE_CRITICAL</td><td>0</td><td>NOTICE_IMPORTANCE</td><td></td></tr><tr><td>随机生成</td><td>比较重要</td><td>NOTICE_IMPORTANCE_HIGH</td><td>1</td><td>NOTICE_IMPORTANCE</td><td></td></tr><tr><td>随机生成</td><td>中等</td><td>NOTICE_IMPORTANCE_MEDIUM</td><td>2</td><td>NOTICE_IMPORTANCE</td><td></td></tr><tr><td>随机生成</td><td>不太重要</td><td>NOTICE_IMPORTANCE_LOW</td><td>3</td><td>NOTICE_IMPORTANCE</td><td></td></tr><tr><td>随机生成</td><td>不重要</td><td>NOTICE_IMPORTANCE_NONE</td><td>4</td><td>NOTICE_IMPORTANCE</td><td></td></tr><tr><td>随机生成</td><td>公告状态</td><td>NOTICE_STATUS</td><td></td><td></td><td>公告业务发布状态（草稿/待审核/已发布）</td></tr><tr><td>随机生成</td><td>草稿</td><td>NOTICE_STATUS_DRAFT</td><td>0</td><td>NOTICE_STATUS</td><td></td></tr><tr><td>随机生成</td><td>待审核</td><td>NOTICE_STATUS_PENDING</td><td>1</td><td>NOTICE_STATUS</td><td></td></tr><tr><td>随机生成</td><td>已发布</td><td>NOTICE_STATUS_PUBLISHED</td><td>2</td><td>NOTICE_STATUS</td><td></td></tr><tr><td>随机生成</td><td>接口协议</td><td>API_PROTOCOL</td><td></td><td></td><td>接口表的协议字典</td></tr><tr><td>随机生成</td><td>HTTP</td><td>API_PROTOCOL_HTTP</td><td>0</td><td>API_PROTOCOL</td><td></td></tr><tr><td>随机生成</td><td>WebSocket</td><td>API_PROTOCOL_WS</td><td>1</td><td>API_PROTOCOL</td><td></td></tr></tbody></table><h4 id="_2-3-4-业务逻辑" tabindex="-1">2.3.4 业务逻辑 <a class="header-anchor" href="#_2-3-4-业务逻辑" aria-label="Permalink to “2.3.4 业务逻辑”">​</a></h4><h5 id="_2-3-4-1-查询逻辑" tabindex="-1">2.3.4.1 查询逻辑 <a class="header-anchor" href="#_2-3-4-1-查询逻辑" aria-label="Permalink to “2.3.4.1 查询逻辑”">​</a></h5><p>字典查询遵循通用列表/树接口的筛选与分页规范，仅保留核心筛选字段：</p><ul><li><code>name</code>：支持模糊查询；</li><li><code>code</code>：支持模糊查询；</li><li><code>value</code>：支持模糊查询。</li></ul><h3 id="_2-4-部门管理" tabindex="-1">2.4 部门管理 <a class="header-anchor" href="#_2-4-部门管理" aria-label="Permalink to “2.4 部门管理”">​</a></h3><h4 id="_2-4-1-部门表设计" tabindex="-1">2.4.1 部门表设计 <a class="header-anchor" href="#_2-4-1-部门表设计" aria-label="Permalink to “2.4.1 部门表设计”">​</a></h4><ul><li>树表实现，使用闭包表（Closure Table）模型。</li></ul><table tabindex="0"><thead><tr><th>字段名</th><th>类型</th><th>描述</th><th>备注</th><th>索引</th><th>可选</th><th>是否唯一</th><th>默认值</th></tr></thead><tbody><tr><td>name</td><td>VARCHAR(128)</td><td>部门名称</td><td></td><td></td><td></td><td>否</td><td></td></tr><tr><td>code</td><td>VARCHAR(64)</td><td>部门编码</td><td>唯一</td><td></td><td></td><td>是</td><td></td></tr><tr><td>parent_id</td><td>UUID</td><td>上级部门</td><td></td><td>是</td><td>是</td><td>否</td><td><code>NULL</code></td></tr><tr><td>leader_id</td><td>UUID</td><td>负责人</td><td>从用户表中选择</td><td>是</td><td>是</td><td>否</td><td><code>NULL</code></td></tr><tr><td>contact_phone</td><td>VARCHAR(64)</td><td>部门联系电话</td><td>必须为字符串</td><td></td><td>是</td><td>否</td><td></td></tr><tr><td>email</td><td>VARCHAR(256)</td><td>部门邮箱</td><td></td><td></td><td>是</td><td>否</td><td></td></tr></tbody></table><h5 id="_2-4-1-1-request-字段" tabindex="-1">2.4.1.1 Request 字段 <a class="header-anchor" href="#_2-4-1-1-request-字段" aria-label="Permalink to “2.4.1.1 Request 字段”">​</a></h5><ul><li>实现表中所有字段</li><li>前端需要提交 <code>parentId</code> 字段，以构建树形结构。</li><li>负责人使用 <code>leaderId</code> 字段，取值来自用户表。</li></ul><h5 id="_2-4-1-2-response-字段" tabindex="-1">2.4.1.2 Response 字段 <a class="header-anchor" href="#_2-4-1-2-response-字段" aria-label="Permalink to “2.4.1.2 Response 字段”">​</a></h5><ul><li>实现 Request 中所有字段，另外查询的时候要有 <code>children</code>。</li></ul><h4 id="_2-4-2-关联" tabindex="-1">2.4.2 关联 <a class="header-anchor" href="#_2-4-2-关联" aria-label="Permalink to “2.4.2 关联”">​</a></h4><ul><li>从 <strong>leader_id</strong> 上和用户进行多对一关联，即一个用户可以负责多个部门，但一个部门只能有一个负责人。</li></ul><h4 id="_2-4-3-接口" tabindex="-1">2.4.3 接口 <a class="header-anchor" href="#_2-4-3-接口" aria-label="Permalink to “2.4.3 接口”">​</a></h4><p>部门模块接口沿用标准树表模块规范：<code>findOne</code>、<code>findList</code>、<code>findTree</code>、<code>findTreeAll</code>、<code>create</code>、<code>createMany</code>、<code>update</code>、<code>delete</code>、<code>deleteMany</code>、<code>remove</code>、<code>removeMany</code>、<code>restore</code>、<code>restoreMany</code>、<code>count</code>，树结构入参/返回规则参考通用规范，这里只在“查询逻辑”中强调 Ripple 特有行为。</p><h5 id="_2-4-3-1-创建-修改逻辑" tabindex="-1">2.4.3.1 创建/修改逻辑 <a class="header-anchor" href="#_2-4-3-1-创建-修改逻辑" aria-label="Permalink to “2.4.3.1 创建/修改逻辑”">​</a></h5><ul><li>部门的 <code>code</code> 字段必须唯一，不允许重复。</li><li>创建/修改部门时，若指定了 <code>parent_id</code>，则必须验证该父级部门是否存在，且不能是当前部门本身或其子部门（通过 <code>dept_closure</code> 检查）以防止循环引用。</li><li>负责人 <code>leader_id</code> 可选；如提供则必须为系统中已存在且有效的用户。</li><li>允许不指定负责人。</li><li>当变更 <code>parent_id</code>（移动节点）时，必须在事务中维护 <code>dept_closure</code>：删除旧祖先关系并按新父级重建；保留所有节点的自反闭包关系。</li></ul><h4 id="_2-4-4-初始化数据" tabindex="-1">2.4.4 初始化数据 <a class="header-anchor" href="#_2-4-4-初始化数据" aria-label="Permalink to “2.4.4 初始化数据”">​</a></h4><table tabindex="0"><thead><tr><th>部门 ID</th><th>部门名称</th><th>部门编码</th><th>父级部门</th><th>是否系统保留</th></tr></thead><tbody><tr><td>随机生成</td><td>公司总部</td><td><code>ORG_ROOT</code></td><td></td><td>是</td></tr></tbody></table><h4 id="_2-4-5-业务逻辑" tabindex="-1">2.4.5 业务逻辑 <a class="header-anchor" href="#_2-4-5-业务逻辑" aria-label="Permalink to “2.4.5 业务逻辑”">​</a></h4><ul><li>当某个部门没有子部门且没有下属业务需要展示时，前端可根据实际需要隐藏展示。</li><li>删除部门前应检查是否存在子部门（<code>dept_closure</code> 中存在 <code>ancestor_id = deptId AND depth &gt; 0</code> 即表示存在后代），若有则阻止删除操作并返回错误信息。</li><li>权限赋予不得硬编码在代码中，与部门相关的访问控制应结合角色与菜单进行设计，不直接绑定在部门上。</li></ul><h5 id="_2-4-5-1-查询逻辑" tabindex="-1">2.4.5.1 查询逻辑 <a class="header-anchor" href="#_2-4-5-1-查询逻辑" aria-label="Permalink to “2.4.5.1 查询逻辑”">​</a></h5><p>部门查询与树接口在筛选、分页上的通用行为与菜单/字典模块保持一致，仅强调部门特有字段及闭包表语义：</p><ul><li><p>筛选字段：</p><ul><li>模糊查询：<code>name</code>、<code>code</code>；</li><li>精确查询：<code>parent_id</code>（只看某父级下的直接子部门）、<code>leader_id</code>、<code>status</code>；</li><li>时间范围：<code>created_time</code>（开始-结束）。</li></ul></li><li><p>树查询说明（闭包表）：</p><ul><li>列表接口中，<code>parent_id</code> 作为过滤条件时，仅返回该父级的直接子部门；</li><li><code>findTree</code> 在提供 <code>rootId</code>（或通过路由参数指定根节点）时，基于 <code>dept_closure</code> 返回以该节点为根的完整子树，<code>findTreeAll</code> 返回整棵树/森林；</li><li>祖先链（用于面包屑）可通过 <code>descendant_id = :deptId</code> 且按 <code>depth</code> 升序获取。</li></ul></li></ul><h3 id="_2-5-公告管理" tabindex="-1">2.5 公告管理 <a class="header-anchor" href="#_2-5-公告管理" aria-label="Permalink to “2.5 公告管理”">​</a></h3><h4 id="_2-5-1-公告表设计" tabindex="-1">2.5.1 公告表设计 <a class="header-anchor" href="#_2-5-1-公告表设计" aria-label="Permalink to “2.5.1 公告表设计”">​</a></h4><ul><li>普通表实现。</li></ul><table tabindex="0"><thead><tr><th>字段名</th><th>类型</th><th>描述</th><th>备注</th><th>索引</th><th>可选</th><th>是否唯一</th><th>默认值</th></tr></thead><tbody><tr><td>title</td><td>VARCHAR(256)</td><td>公告标题</td><td></td><td></td><td></td><td>否</td><td></td></tr><tr><td>description</td><td>VARCHAR(512)</td><td>公告描述</td><td>简短描述，用于列表展示</td><td></td><td>是</td><td>否</td><td></td></tr><tr><td>content</td><td>TEXT</td><td>公告内容</td><td>存储 Markdown 原文</td><td></td><td></td><td>否</td><td></td></tr><tr><td>importance</td><td>VARCHAR(32)</td><td>重要程度</td><td>取自字典 NOTICE_IMPORTANCE</td><td></td><td></td><td>否</td><td><code>2</code></td></tr><tr><td>publish_status</td><td>VARCHAR(32)</td><td>发布状态</td><td>取自字典 NOTICE_STATUS</td><td>是</td><td></td><td>否</td><td><code>0</code></td></tr><tr><td>publish_time</td><td>timestamptz</td><td>发布时间</td><td>UTC</td><td></td><td>是</td><td>否</td><td><code>NULL</code></td></tr><tr><td>expire_time</td><td>timestamptz</td><td>过期时间</td><td>到期不再推送/展示（不删除数据）</td><td></td><td>是</td><td>否</td><td><code>NULL</code></td></tr><tr><td>pinned</td><td>BOOLEAN</td><td>是否置顶</td><td></td><td></td><td>是</td><td>否</td><td><code>false</code></td></tr></tbody></table><h5 id="_2-5-1-1-request-字段" tabindex="-1">2.5.1.1 Request 字段 <a class="header-anchor" href="#_2-5-1-1-request-字段" aria-label="Permalink to “2.5.1.1 Request 字段”">​</a></h5><ul><li>实现表中所有字段</li><li>接受 <code>deptIds</code> 数组字段，用于指定公告范围（以部门为单位）。</li></ul><h5 id="_2-5-1-2-response-字段" tabindex="-1">2.5.1.2 Response 字段 <a class="header-anchor" href="#_2-5-1-2-response-字段" aria-label="Permalink to “2.5.1.2 Response 字段”">​</a></h5><ul><li>实现 Request 中所有字段。</li></ul><h4 id="_2-5-2-关联" tabindex="-1">2.5.2 关联 <a class="header-anchor" href="#_2-5-2-关联" aria-label="Permalink to “2.5.2 关联”">​</a></h4><ol><li>和部门关联，多对多关系，一个公告可面向多个部门，一个部门可接收多个公告，通过关联表实现。</li><li>与用户的阅读状态通过关联表记录：<code>notice_reads(user_id, notice_id, read_time)</code>（用于未读/已读统计与补偿）。</li></ol><h4 id="_2-5-3-接口" tabindex="-1">2.5.3 接口 <a class="header-anchor" href="#_2-5-3-接口" aria-label="Permalink to “2.5.3 接口”">​</a></h4><ul><li><code>findOne</code></li><li><code>findList</code></li><li><code>create</code></li><li><code>createMany</code></li><li><code>update</code></li><li><code>delete</code></li><li><code>deleteMany</code></li><li><code>remove</code></li><li><code>removeMany</code></li><li><code>restore</code></li><li><code>restoreMany</code></li><li><code>count</code></li><li><code>findOnlyDeleted</code></li><li><code>push</code> - 公告推送（基于 WebSocket）</li></ul><h4 id="_2-5-4-初始化数据" tabindex="-1">2.5.4 初始化数据 <a class="header-anchor" href="#_2-5-4-初始化数据" aria-label="Permalink to “2.5.4 初始化数据”">​</a></h4><ul><li>无。</li></ul><h4 id="_2-5-5-业务逻辑" tabindex="-1">2.5.5 业务逻辑 <a class="header-anchor" href="#_2-5-5-业务逻辑" aria-label="Permalink to “2.5.5 业务逻辑”">​</a></h4><ul><li>公告内容以 Markdown 形式输入与存储，前端展示一个 Markdown 编辑器用于录入与预览。</li><li>公告范围以部门为单位，后端依据 <code>deptIds</code> 解析受众用户集合；权限控制通过菜单与角色赋予实现，不得在代码中硬编码。</li><li>公告的业务发布状态与通用启用状态分离： <ul><li><code>status</code> 字段为通用启用状态，引用 <code>STATUS</code> 字典；</li><li><code>publish_status</code> 字段为业务发布状态，引用 <code>NOTICE_STATUS</code> 字典，其中：<code>0</code> 表示草稿，<code>1</code> 表示待审核，<code>2</code> 表示已发布。</li></ul></li><li>仅当公告 <code>status</code> 为有效且 <code>publish_status</code> 为“已发布”时对普通用户可见；未登录用户不可见公告数据。</li><li>删除公告前无需进行额外的业务约束检查；如实际业务需要可在实现阶段补充限制。</li></ul><h5 id="_2-5-5-1-推送逻辑-websocket" tabindex="-1">2.5.5.1 推送逻辑（WebSocket） <a class="header-anchor" href="#_2-5-5-1-推送逻辑-websocket" aria-label="Permalink to “2.5.5.1 推送逻辑（WebSocket）”">​</a></h5><div class="info custom-block github-alert"><p class="custom-block-title">INFO</p><p>在 WebSocket 功能关闭时，推送功能不可用，前端提示“WebSocket 功能未启用，无法接收公告推送，请联系管理员。”。</p></div><ul><li>公告推送通过长连接进行，<code>action</code> 代码固定为 <code>notice</code>。</li><li>推送时机： <ul><li>管理端在编辑页主动触发 <code>push</code> 接口进行即时推送；</li><li>或在创建/更新公告后由管理员手动推送。</li></ul></li><li>推送目标：当前在线且属于目标部门集合（<code>deptIds</code>）内的用户会收到消息；离线用户可在下次登录后通过列表接口查询公告。</li><li>推送只包含近 50 条未读信息，如果用户需要更多公告，应通过列表接口查询。</li><li>服务端推送消息示例：</li></ul><div class="language-jsonc"><button title="Copy Code" class="copy"></button><span class="lang">jsonc</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;requestId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;action&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;notice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;businessCode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;isSuccess&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;有新的公告&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;noticeId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;系统维护通知&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;desc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;简短描述&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;importance&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;deptIds&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;uuid-1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;uuid-2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;createdTime&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-11-13T09:00:00.000Z&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;timestamp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-11-13T09:00:00.000Z&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;errors&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>为了减轻 WS 服务器压力，公告推送不包含公告内容，用户需要查看公告详情时，应通过 RESTful API 获取完整内容。</li></ul><h5 id="_2-5-5-2-查询逻辑" tabindex="-1">2.5.5.2 查询逻辑 <a class="header-anchor" href="#_2-5-5-2-查询逻辑" aria-label="Permalink to “2.5.5.2 查询逻辑”">​</a></h5><p>公告列表的查询行为遵循通用规范，Ripple 仅补充与公告业务强相关的筛选字段：</p><ul><li>模糊查询：<code>title</code>；</li><li>精确查询：<code>importance</code>、<code>status</code>、<code>publishStatus</code>；</li><li>多选：<code>deptIds</code>（目标范围至少包含其中任一部门的公告）；</li><li>时间范围：<code>createdTime</code>（开始-结束）。</li></ul><p>组合规则与其他模块保持一致：除 <code>dept_ids</code> 在集合内采用 OR 逻辑外，不同字段之间默认采用 AND 组合。</p><h3 id="_2-6-系统内置-api-权限点" tabindex="-1">2.6 系统内置 API 权限点 <a class="header-anchor" href="#_2-6-系统内置-api-权限点" aria-label="Permalink to “2.6 系统内置 API 权限点”">​</a></h3><h4 id="_2-6-1-表设计" tabindex="-1">2.6.1 表设计 <a class="header-anchor" href="#_2-6-1-表设计" aria-label="Permalink to “2.6.1 表设计”">​</a></h4><ul><li>本表用于存储系统内置的 API 权限点元数据，避免在代码中硬编码权限点字符串，由该表作为权限编码（permission code）的权威来源。</li><li>表名： <code>system_api_perm</code></li></ul><table tabindex="0"><thead><tr><th>字段名</th><th>类型</th><th>描述</th><th>备注</th><th>索引</th><th>可选</th><th>是否唯一</th><th>默认值</th></tr></thead><tbody><tr><td>name</td><td>VARCHAR(128)</td><td>权限名称</td><td>便于人类阅读的名称</td><td></td><td></td><td>否</td><td></td></tr><tr><td>code</td><td>VARCHAR(128)</td><td>权限编码</td><td>对应接口使用的权限点编码（如 <code>user:list</code>）</td><td>是</td><td></td><td>是</td><td></td></tr><tr><td>module</td><td>VARCHAR(64)</td><td>所属模块</td><td>如 <code>user</code>、<code>role</code>、<code>menu</code> 等</td><td>是</td><td>是</td><td>否</td><td></td></tr></tbody></table><p>其他公共字段（主键、审计时间、删除标记、系统保留标记等）与通用规范保持一致，此处不再重复。 描述放在公共的 <code>remark</code> 字段中。</p><h5 id="_2-6-1-1-request-字段" tabindex="-1">2.6.1.1 Request 字段 <a class="header-anchor" href="#_2-6-1-1-request-字段" aria-label="Permalink to “2.6.1.1 Request 字段”">​</a></h5><ul><li>实现表中除公共字段外的所有字段：<code>name</code>、<code>code</code>、<code>module</code>；</li><li><code>code</code> 为必填且唯一；</li></ul><h5 id="_2-6-1-2-response-字段" tabindex="-1">2.6.1.2 Response 字段 <a class="header-anchor" href="#_2-6-1-2-response-字段" aria-label="Permalink to “2.6.1.2 Response 字段”">​</a></h5><ul><li>实现 Request 中所有字段；</li><li>不额外暴露内部审计字段。</li></ul><h5 id="_2-6-1-3-关联" tabindex="-1">2.6.1.3 关联 <a class="header-anchor" href="#_2-6-1-3-关联" aria-label="Permalink to “2.6.1.3 关联”">​</a></h5><ul><li>和 <code>system_api_list</code> 多对多关联，通过关联表 <code>system_api_perm_relation(api_id, perm_id)</code> 实现。</li></ul><h4 id="_2-6-2-接口" tabindex="-1">2.6.2 接口 <a class="header-anchor" href="#_2-6-2-接口" aria-label="Permalink to “2.6.2 接口”">​</a></h4><p><code>system_api_perm</code> 模块沿用通用规范中的标准 CRUD 接口集合：</p><ul><li><code>findOne</code>、<code>findList</code>、<code>create</code>、<code>createMany</code>、<code>update</code>、<code>delete</code>、<code>deleteMany</code>、<code>remove</code>、<code>removeMany</code>、<code>restore</code>、<code>restoreMany</code>、<code>count</code>、<code>findOnlyDeleted</code>。</li></ul><p>其中：</p><ul><li>仅具有系统管理相关权限的管理员/超级管理员可以访问该模块接口（也是动态赋权）；</li><li>普通业务角色用户默认不可见该模块菜单和接口。</li></ul><h4 id="_2-6-3-初始化数据" tabindex="-1">2.6.3 初始化数据 <a class="header-anchor" href="#_2-6-3-初始化数据" aria-label="Permalink to “2.6.3 初始化数据”">​</a></h4><p>初始化时应当为核心系统接口预置权限点，下面表格仅为示例，实际以通用规范和实现为准：</p><table tabindex="0"><thead><tr><th>权限 ID</th><th>权限名称</th><th>权限编码</th><th>所属模块</th><th>是否系统保留</th></tr></thead><tbody><tr><td>随机生成</td><td>用户列表查询</td><td><code>dashboard:user:manage</code></td><td>user</td><td>是</td></tr><tr><td>随机生成</td><td>角色列表查询</td><td><code>dashboard:user:role</code></td><td>role</td><td>是</td></tr><tr><td>随机生成</td><td>菜单管理</td><td><code>dashboard:system:menu</code></td><td>menu</td><td>是</td></tr><tr><td>随机生成</td><td>部门管理</td><td><code>dashboard:system:dept</code></td><td>dept</td><td>是</td></tr><tr><td>随机生成</td><td>公告管理</td><td><code>dashboard:system:notice</code></td><td>notice</td><td>是</td></tr><tr><td>随机生成</td><td>在线用户</td><td><code>dashboard:system:online</code></td><td>online</td><td>是</td></tr></tbody></table><p>说明：</p><ul><li>这些初始化权限点的 <code>code</code> 可供菜单和接口引用，菜单通过 <code>permission_code_id</code> 关联到对应记录；</li><li>后续如增加新的系统功能，应先在 <code>system_api_perm</code> 中登记对应权限点，再配置菜单和角色。</li></ul><h4 id="_2-6-4-业务规则" tabindex="-1">2.6.4 业务规则 <a class="header-anchor" href="#_2-6-4-业务规则" aria-label="Permalink to “2.6.4 业务规则”">​</a></h4><ul><li><p><strong>权限点来源统一</strong>：</p><ul><li>所有需要鉴权保护的接口必须在 <code>system_api_perm</code> 中有对应记录；</li><li>菜单表通过 <code>permission_code_id</code> 关联 <code>system_api_perm</code>，Casbin 策略中的 <code>obj</code> 字段仅能引用 <code>system_api_perm.code</code>，不允许在代码或配置中直接拼接字符串常量作为权限点；</li><li>若某个权限点不再使用，应先从角色/菜单配置中移除，再将其标记删除或软删除。</li></ul></li><li><p><strong>系统保留权限点</strong>：</p><ul><li><code>is_system_reserved = TRUE</code> 的权限点视为系统保留数据，不允许通过前台界面删除；</li><li>若确需调整系统保留权限点，仅能通过数据库迁移脚本进行；</li><li>与系统保留权限点对应的菜单和角色也应遵循本设计文档及通用规范中“系统保留数据”的约束。</li></ul></li><li><p><strong>与角色/菜单/Casbin 的关系</strong>：</p><ul><li>角色通过角色-菜单关联间接获得权限点，菜单的 <code>permission_code_id</code> 必须指向有效的 <code>system_api_perm</code> 记录，由该记录的 <code>code</code> 参与权限判定；</li><li>当角色的 <code>menuIds</code> 集合发生变更时，Service 层应根据新的菜单集合查出对应的 <code>permission_code_id</code>，联表 <code>system_api_perm</code> 得到 <code>code</code> 列表，在写入 Casbin 策略前校验这些编码均存在于 <code>system_api_perm</code>；</li><li>任何新增的受控接口在开发阶段都应先补充 <code>system_api_perm</code> 初始化或迁移脚本，确保权限点元数据完整。</li></ul></li></ul><h3 id="_2-7-接口表" tabindex="-1">2.7 接口表 <a class="header-anchor" href="#_2-7-接口表" aria-label="Permalink to “2.7 接口表”">​</a></h3><h4 id="_2-7-1-表设计" tabindex="-1">2.7.1 表设计 <a class="header-anchor" href="#_2-7-1-表设计" aria-label="Permalink to “2.7.1 表设计”">​</a></h4><p>表名：<code>system_api_list</code></p><table tabindex="0"><thead><tr><th>字段名</th><th>类型</th><th>描述</th><th>备注</th><th>索引</th><th>可选</th><th>是否唯一</th><th>默认值</th></tr></thead><tbody><tr><td>name</td><td>VARCHAR(128)</td><td>接口名称模板</td><td>如：<code>/auth/login</code>，和 api_version 拼接即为完整 path，且支持识别 <code>/xxx/:id</code> 这一段路由。</td><td></td><td>是</td><td>否</td><td></td></tr><tr><td>protocol</td><td>VARCHAR(32)</td><td>协议</td><td>字典值</td><td></td><td></td><td>否</td><td>&quot;0&quot;</td></tr><tr><td>http_method</td><td>VARCHAR(64)</td><td>HTTP 方法</td><td>字符串输入，不是 http 协议时必须为空</td><td></td><td>是</td><td>否</td><td></td></tr><tr><td>ws_action</td><td>VARCHAR(64)</td><td>WS 操作</td><td>字符串输入，不是 websocket 协议时必须为空</td><td></td><td>是</td><td>否</td><td></td></tr><tr><td>api_version</td><td>VARCHAR(32)</td><td>API 版本</td><td>直接输入字符串，如 &quot;v1&quot;、&quot;v2&quot;</td><td></td><td></td><td>是</td><td>&quot;v1&quot;</td></tr></tbody></table><p>备注：</p><ul><li><code>api_version</code> 和 <code>name</code> 拼接之后，即为完整接口名称，如 <code>/v1/auth/login</code>；</li><li>WebSocket 接口必须在本表中以 <code>protocol = &quot;1&quot;</code>、<code>ws_action = &lt;action&gt;</code> 的形式登记，并通过与 <code>system_api_perm</code> 的多对多关系绑定权限点，服务端在处理 WebSocket 消息时应根据消息中的 <code>action</code> 字段查找本表配置并执行同样的权限校验流程。</li></ul><h5 id="_2-7-1-1-request-和-response" tabindex="-1">2.7.1.1 Request 和 Response <a class="header-anchor" href="#_2-7-1-1-request-和-response" aria-label="Permalink to “2.7.1.1 Request 和 Response”">​</a></h5><ul><li>实现表中所有字段；</li></ul><h4 id="_2-7-2-关联" tabindex="-1">2.7.2 关联 <a class="header-anchor" href="#_2-7-2-关联" aria-label="Permalink to “2.7.2 关联”">​</a></h4><p>见 2.6.1.3。</p><h4 id="_2-7-3-接口" tabindex="-1">2.7.3 接口 <a class="header-anchor" href="#_2-7-3-接口" aria-label="Permalink to “2.7.3 接口”">​</a></h4><ul><li>沿用通用规范中的标准 CRUD 接口集合。</li></ul><h2 id="_3-登录鉴权" tabindex="-1">3. 登录鉴权 <a class="header-anchor" href="#_3-登录鉴权" aria-label="Permalink to “3. 登录鉴权”">​</a></h2><h3 id="_3-1-登录和注册" tabindex="-1">3.1 登录和注册 <a class="header-anchor" href="#_3-1-登录和注册" aria-label="Permalink to “3.1 登录和注册”">​</a></h3><h4 id="_3-1-1-request-和-response" tabindex="-1">3.1.1 Request 和 Response <a class="header-anchor" href="#_3-1-1-request-和-response" aria-label="Permalink to “3.1.1 Request 和 Response”">​</a></h4><h5 id="_3-1-1-1-loginrequest" tabindex="-1">3.1.1.1 LoginRequest <a class="header-anchor" href="#_3-1-1-1-loginrequest" aria-label="Permalink to “3.1.1.1 LoginRequest”">​</a></h5><div class="language-jsonc"><button title="Copy Code" class="copy"></button><span class="lang">jsonc</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 用户名</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;password&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 密码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;captchaId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 验证码 ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;captcha&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 验证码内容</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;loginType&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 登录类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h5 id="_3-1-1-2-loginresponse" tabindex="-1">3.1.1.2 LoginResponse <a class="header-anchor" href="#_3-1-1-2-loginresponse" aria-label="Permalink to “3.1.1.2 LoginResponse”">​</a></h5><div class="language-jsonc"><button title="Copy Code" class="copy"></button><span class="lang">jsonc</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;userId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;userName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;permissionCodes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;string&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 用户权限编码列表（菜单按钮 permission_code）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;systemRoles&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;root&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 用户角色编码列表</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;systemMenus&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [], </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 用户菜单树（仅包含当前用户有权限访问的菜单），结构参考菜单管理模块</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;accessToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// JWT 访问令牌</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;refreshToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 刷新令牌</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;expiresIn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 访问令牌剩余有效期（秒）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;refreshExpiresIn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 刷新令牌剩余有效期（秒）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;features&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;websocket&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 是否启用了 WebSocket 功能</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h5 id="_3-1-1-3-registerrequest" tabindex="-1">3.1.1.3 RegisterRequest <a class="header-anchor" href="#_3-1-1-3-registerrequest" aria-label="Permalink to “3.1.1.3 RegisterRequest”">​</a></h5><div class="language-jsonc"><button title="Copy Code" class="copy"></button><span class="lang">jsonc</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 用户名（英文字母，唯一）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;nickName&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 昵称</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;email&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 邮箱，注册时可选</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;phone&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 手机号，注册时可选（字符串）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;password&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 密码，最少 12 位</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;captchaId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 验证码 ID</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;captcha&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 验证码内容</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;loginType&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 固定为 1，表示注册场景</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h5 id="_3-1-1-4-refreshtokenrequest" tabindex="-1">3.1.1.4 RefreshTokenRequest <a class="header-anchor" href="#_3-1-1-4-refreshtokenrequest" aria-label="Permalink to “3.1.1.4 RefreshTokenRequest”">​</a></h5><div class="language-jsonc"><button title="Copy Code" class="copy"></button><span class="lang">jsonc</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;refreshToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 刷新令牌</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h5 id="_3-1-1-5-refreshtokenresponse" tabindex="-1">3.1.1.5 RefreshTokenResponse <a class="header-anchor" href="#_3-1-1-5-refreshtokenresponse" aria-label="Permalink to “3.1.1.5 RefreshTokenResponse”">​</a></h5><div class="language-jsonc"><button title="Copy Code" class="copy"></button><span class="lang">jsonc</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;newAccessToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 新的 JWT 访问令牌</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;newRefreshToken&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 新的刷新令牌</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;expiresIn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 新访问令牌剩余有效期（秒）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;refreshExpiresIn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 新刷新令牌剩余有效期（秒）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h5 id="_3-1-1-6-captcharesponse" tabindex="-1">3.1.1.6 CaptchaResponse <a class="header-anchor" href="#_3-1-1-6-captcharesponse" aria-label="Permalink to “3.1.1.6 CaptchaResponse”">​</a></h5><div class="language-jsonc"><button title="Copy Code" class="copy"></button><span class="lang">jsonc</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;captchaId&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 验证码 ID（UUIDv7）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;imageBase64&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 验证码图片 Base64 编码（data URL 或纯 Base64，根据前端需要约定）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;expiresIn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">120</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 验证码有效期（秒）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="_3-1-2-接口" tabindex="-1">3.1.2 接口 <a class="header-anchor" href="#_3-1-2-接口" aria-label="Permalink to “3.1.2 接口”">​</a></h4><table tabindex="0"><thead><tr><th>接口名称</th><th>方法</th><th>路径</th><th>描述</th></tr></thead><tbody><tr><td>登录</td><td>POST</td><td>/auth/login</td><td>用户登录，成功后返回 JWT 及用户权限、菜单等信息</td></tr><tr><td>注册</td><td>POST</td><td>/auth/register</td><td>用户注册，仅创建普通用户</td></tr><tr><td>刷新令牌</td><td>POST</td><td>/auth/refresh</td><td>刷新访问令牌，使用 refreshToken 获取新的访问/刷新对</td></tr><tr><td>验证码</td><td>GET</td><td>/auth/captcha</td><td>获取登录/注册验证码</td></tr><tr><td>退出登录</td><td>POST</td><td>/auth/logout</td><td>用户主动退出登录，主动失效当前会话</td></tr></tbody></table><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>实际对外路由应结合模块前缀与版本号，例如 <code>/v1/auth/login</code>。内部实现中应按照《后端项目开发规范（通用）》在模块内定义路由前缀常量。</p></div><ul><li>登录/注册/验证码等所有开放接口也必须在 <code>system_api_list</code> 中登记，并绑定权限点，同时该权限点必须授予 <code>visitor</code> 角色</li></ul><h4 id="_3-1-3-业务规则" tabindex="-1">3.1.3 业务规则 <a class="header-anchor" href="#_3-1-3-业务规则" aria-label="Permalink to “3.1.3 业务规则”">​</a></h4><h5 id="_3-1-3-1-登录规则" tabindex="-1">3.1.3.1 登录规则 <a class="header-anchor" href="#_3-1-3-1-登录规则" aria-label="Permalink to “3.1.3.1 登录规则”">​</a></h5><ul><li><code>guest</code> 保留用户禁止手动登录，前后端均需校验： <ul><li>当 <code>name</code> 为 <code>guest</code> 时，无论密码是否正确，都直接返回业务错误。</li></ul></li><li>登录接口必须校验验证码，验证码错误时直接返回业务错误，<strong>不进入密码校验逻辑</strong>，避免暴力攻击。</li><li>登录失败次数记录在 <code>Redis</code> 中，Key 规范： <ul><li><code>ripple:auth:login:fail:&lt;userName&gt;</code></li><li>每次登录失败时，失败次数加 1，并设置合理的过期时间（例如 30 分钟，具体在实现阶段确认）。</li><li>当失败次数 ≥ 10 次时，锁定该用户名 15 分钟，在锁定期间： <ul><li>无论密码是否正确，均返回统一的“用户名或密码错误”提示。</li><li>可以通过在 <code>Redis</code> 设置单独锁定 Key（如 <code>ripple:auth:login:lock:&lt;userName&gt;</code>）来实现。</li></ul></li><li>登录成功后，清除该用户的失败记录与锁定记录（如有）。</li></ul></li><li>登录失败统一提示“用户名或密码错误”，不区分“用户不存在、密码错误、被锁定”，避免泄露用户存在性与安全状态。</li><li>账户状态校验： <ul><li>若用户 <code>status</code> 为无效（字典 <code>STATUS_DISABLED</code> 对应值），禁止登录，返回业务错误。</li><li>系统保留用户 <code>is_system_reserved = true</code> 允许登录，但后续权限由角色/菜单控制。</li></ul></li><li>设备/会话策略（基础版）： <ul><li>默认允许同一用户多终端多会话共存。</li><li>每次登录成功后，都会生成新的 <code>sessionId</code> 并记录到在线用户模块所描述的 Redis 结构中。</li><li>如未来需要“单设备登录”或“同一终端互斥登录”，可在登录逻辑中增加会话清理策略。</li></ul></li><li>安全存储： <ul><li>密码使用 <code>argon2id</code> 加盐哈希存储（标准编码串），签名时避免泄露参数。</li><li>登录成功后记录 <code>last_login_time</code> 和 <code>last_login_ip</code>（用于审计/风控）。</li></ul></li><li>用户在收到登录响应中 <code>features.websocket = true</code> 时，才尝试建立 WebSocket 连接。为 <code>false</code> 时，不建立连接，并在前端关闭相关功能入口或提示不可用。</li></ul><h5 id="_3-1-3-2-注册规则" tabindex="-1">3.1.3.2 注册规则 <a class="header-anchor" href="#_3-1-3-2-注册规则" aria-label="Permalink to “3.1.3.2 注册规则”">​</a></h5><ul><li>注册接口为开放接口，允许未登录用户（<code>guest</code>）访问，但应受到验证码与频率限制保护。</li><li>禁止通过注册接口创建 <code>root</code> 与 <code>guest</code> 用户： <ul><li>若注册请求中的 <code>name</code> 为 <code>root</code> 或 <code>guest</code>，直接返回业务错误。</li></ul></li><li>注册成功后： <ul><li>新用户默认分配普通用户角色 <code>user</code>，不授予 <code>admin</code> 或 <code>root</code> 角色。</li><li>不自动登录，注册成功后仍需显式登录，登录逻辑统一。</li></ul></li><li>用户名必须唯一，且仅允许英文字母（或字母数字），具体规则在实现时通过后端校验+数据库唯一索引双重保障；<code>LOWER(name)</code>。</li><li>密码规则： <ul><li>长度至少 12 位；必须在前后端同时校验。</li></ul></li><li>邮箱和手机号： <ul><li>可选字段，但如填写则须唯一（通过部分唯一索引保障）。</li><li>格式在前端和后端均需校验，后端校验失败视为参数错误。</li></ul></li></ul><h5 id="_3-1-3-3-刷新令牌规则" tabindex="-1">3.1.3.3 刷新令牌规则 <a class="header-anchor" href="#_3-1-3-3-刷新令牌规则" aria-label="Permalink to “3.1.3.3 刷新令牌规则”">​</a></h5><ul><li>刷新令牌接口 <code>/auth/refresh</code> 仅验证 <code>refreshToken</code> 的有效性，不依赖当前访问令牌是否过期。</li><li>匿名访问场景下（<code>guest</code> 身份）不涉及访问/刷新令牌的签发和使用，因此禁止以 <code>guest</code> 身份调用 <code>/auth/refresh</code> 接口： <ul><li>如果 refreshToken 解析出来的 user 是 guest，则抛出错误。</li></ul></li><li>刷新成功后行为： <ul><li>返回新的访问令牌 <code>newAccessToken</code> 与新的刷新令牌 <code>newRefreshToken</code>。</li><li><strong>旧的刷新令牌立即失效</strong>，必须加入黑名单或存储状态为“已使用”，防止重放攻击（黑名单 Key TTL 设置为该 Token 剩余有效期）。</li></ul></li><li>刷新令牌应包含独立的唯一标识（<code>jti</code>），方便在 Redis 中进行黑名单/状态管理： <ul><li>推荐 Key 结构：<code>ripple:auth:refresh:blacklist:&lt;jti&gt;</code> 或 <code>ripple:auth:refresh:used:&lt;jti&gt;</code>。</li></ul></li><li>刷新令牌的有效期应明显长于访问令牌，具体数值在实现阶段由配置决定： <ul><li>例如：访问令牌 15 分钟，刷新令牌 7 天。</li></ul></li><li>刷新失败统一返回明确的业务错误描述，不应暴露具体内部状态（如“黑名单命中”等实现细节）。</li></ul><h5 id="_3-1-3-4-验证码规则" tabindex="-1">3.1.3.4 验证码规则 <a class="header-anchor" href="#_3-1-3-4-验证码规则" aria-label="Permalink to “3.1.3.4 验证码规则”">​</a></h5><ul><li>验证码接口 <code>/auth/captcha</code> 接受 <code>loginType</code> 参数，允许的值为 <code>0</code>、<code>1</code>： <ul><li><code>0</code>：登录</li><li><code>1</code>：注册</li></ul></li><li>验证码生成规则： <ul><li>生成 <code>captchaId</code>（UUIDv7）与对应的验证码内容（例如 4~6 位数字或字母）。</li><li>将验证码内容存入 Redis，Key 示例： <ul><li><code>ripple:auth:captcha:login:&lt;captchaId&gt;</code>（对于 <code>loginType=0</code>）</li><li><code>ripple:auth:captcha:register:&lt;captchaId&gt;</code>（对于 <code>loginType=1</code>）</li></ul></li><li>设置有限的有效期（例如 120 秒），过期后不可使用。</li></ul></li><li>前后端交互： <ul><li>前端调用 <code>/auth/captcha</code>，获得 <code>captchaId</code> + <code>imageBase64</code>；</li><li>登录/注册 Request 中同时提交 <code>captchaId</code> 和 <code>captcha</code>。</li></ul></li><li>校验行为： <ul><li>验证码使用一次后立即失效，无论校验成功与否。</li><li>验证码错误时，不返回“验证码错误”的明确提示，可采用泛化提示（由实现阶段决定）。</li></ul></li><li>防刷策略： <ul><li>验证码请求频率应受限（例如同一 IP / 同一客户端在短时间内的请求数），以防止验证码接口被滥用。</li></ul></li></ul><h5 id="_3-1-3-5-退出登录规则" tabindex="-1">3.1.3.5 退出登录规则 <a class="header-anchor" href="#_3-1-3-5-退出登录规则" aria-label="Permalink to “3.1.3.5 退出登录规则”">​</a></h5><ul><li>退出登录接口 <code>/auth/logout</code> 需要在鉴权后调用，仅对已登录用户有效。</li><li>退出登录行为： <ul><li>清理当前会话相关的在线用户记录： <ul><li>删除 <code>ripple:auth:online:session:&lt;sessionId&gt;</code>。</li><li>从 <code>ripple:auth:online:user:&lt;userId&gt;</code> 中移除 <code>sessionId</code>，必要时删除空的集合。</li></ul></li><li>将当前访问令牌的 <code>jti</code> 加入访问令牌黑名单，确保在剩余有效期内不能再被使用。</li><li>如当前会话存在 WebSocket 连接，应通知对应连接断开（可作为实现阶段的优化）。</li></ul></li><li>不要求在退出时强制失效所有会话，仅当前会话即可；如需“退出所有设备”，可在用户模块提供额外接口，并复用在线用户模块的踢下线能力。</li></ul><h3 id="_3-2-鉴权" tabindex="-1">3.2 鉴权 <a class="header-anchor" href="#_3-2-鉴权" aria-label="Permalink to “3.2 鉴权”">​</a></h3><h4 id="_3-2-1-业务规则" tabindex="-1">3.2.1 业务规则 <a class="header-anchor" href="#_3-2-1-业务规则" aria-label="Permalink to “3.2.1 业务规则”">​</a></h4><ul><li>未登录用户默认视为 <code>guest</code> 用户： <ul><li>系统在初始化时会创建一个真实的 <code>guest</code> 用户，使用固定 UUID，仅具备 <code>visitor</code> 角色权限；</li><li>在中间件层，如未携带有效 Token，应将当前请求标记为 <code>guest</code> 身份（<code>userId</code> 为该固定 UUID），该身份不能通过登录接口获得，也不会为其签发访问/刷新令牌；</li><li>登录、注册、获取验证码等接口显式允许 <code>guest</code> 身份访问。</li><li>不再单独设计名为 <code>public</code> 的权限点；若某个接口需要对所有用户开放，只需将对应权限点授予 <code>visitor</code> 角色即可，被授予给 <code>visitor</code> 的权限即视为“公开接口”。</li></ul></li><li>采用基于角色的访问控制（RBAC）模型： <ul><li>每个用户可以拥有多个角色（如 <code>root</code>、<code>admin</code>、<code>user</code>、<code>visitor</code>）。</li><li>每个角色与菜单项（包括按钮级别）建立多对多关联。</li><li>每个菜单项（尤其是按钮）对应具体的权限点，但菜单表仅通过 <code>permission_code_id</code> 关联到 <code>system_api_perm</code>，实际的权限编码由 <code>system_api_perm.code</code> 提供，例如： <ul><li><code>dashboard:system:menu:create</code></li><li><code>dashboard:user:manage:delete</code></li></ul></li></ul></li><li>API 权限模型： <ul><li>每个受保护的 API 方法必须在接口表中配置至少一个权限点（权限编码）；一个接口可以绑定多个权限点，一个权限点也可以被多个接口复用，具体关系由 <code>system_api_list</code> 与 <code>system_api_perm</code> 的多对多关联决定。权限点名称应形象、语义化，推荐与方法语义或菜单所关联的 <code>system_api_perm.code</code> 保持一致风格，而非强制完全相同。</li><li>接口绑定多个权限点时，这些权限点在鉴权层一律按 <strong>OR 关系</strong> 处理：只要用户拥有其中任意一个权限点，即视为通过该接口的权限校验；如确有 AND 关系的复杂业务需求，应拆分为多个接口或在业务逻辑中进行二次校验，本设计不支持通过「绑定多个权限点」来实现 AND 关系，且不推荐这么做。</li><li>查询类接口权限： <ul><li>查看已删除数据的能力被视为一项特殊权限，但通过独立接口实现（不再通过 <code>mode</code> 参数切换）。</li><li>若模块提供 <code>findWithDeleted</code> / <code>findWithDeletedAll</code> / <code>findOnlyDeleted</code> / <code>findOnlyDeletedAll</code> 等接口，应在 Casbin 策略中为每个接口配置独立权限点，命名规则与菜单所关联的 <code>system_api_perm.code</code> 保持一致。</li><li><code>findAll</code> 以及 <code>findWithDeletedAll</code> / <code>findOnlyDeletedAll</code> 等“不分页全量”接口，由于可能返回大量数据，必须绑定单独权限点，防止被滥用。</li></ul></li><li>软删除相关权限： <ul><li><code>remove</code>/<code>removeMany</code> 与 <code>restore</code>/<code>restoreMany</code> 对应独立权限点，不能与 <code>delete</code>/<code>deleteMany</code> 混用。</li></ul></li><li>鉴权实现方式： <ul><li>基于 Casbin 进行策略管理： <ul><li>模型定义：采用 RBAC 模型。</li><li>主体 (Subject)：角色编码 (Role Code)，例如 <code>admin</code>、<code>user</code>。</li><li>对象 (Object)：权限编码 (Permission Code)，例如 <code>dashboard:user:list</code>。</li><li>动作 (Action)：统一固定为 <code>allow</code>（或根据 RESTful 方法映射，但建议直接以权限编码作为唯一标识）。</li></ul></li><li>策略存储与加载： <ul><li>使用 GORM Adapter 连接数据库中的 <code>casbin_rule</code> 表，仅维护“角色 → 权限点”的 <code>p</code> 策略数据。</li><li>不在 Casbin 中维护用户与角色的 <code>g</code> 策略，用户拥有哪些角色由业务逻辑与 Token 负责维护。</li><li>启用 Watcher 机制或在修改角色/菜单的 Service 层显式调用 <code>LoadPolicy()</code>，确保内存中的 Enforcer 实时感知数据库变更。</li></ul></li><li>中间件判定逻辑： <ul><li>解析 Token 获取当前用户的 <code>roles</code>（例如 <code>[&quot;admin&quot;, &quot;user&quot;]</code>）。</li><li>通过 URL + HTTP Method 从本地内存中的“接口 → 权限点”映射表中获取当前请求对应的 API 权限点列表（例如 <code>[&quot;system:user:list&quot;]</code> 或 <code>[&quot;system:user:list&quot;, &quot;system:user:export&quot;]</code>）。</li><li>遍历用户拥有的每一个角色，调用 <code>Enforce(role, permission_code, &quot;allow&quot;)</code>（此时 <code>sub</code> 即为角色编码，<code>permission_code</code> 来自 <code>system_api_perm.code</code>）。</li><li>只要有一个角色返回 <code>true</code>，即视为鉴权通过。</li></ul></li><li>权限点缓存策略： <ul><li>系统启动时，从数据库中全量加载 <code>system_api_list</code> 与 <code>system_api_perm</code> 及其关联关系： <ul><li>对于 HTTP 接口，构建「URL + HTTP Method → 权限点编码列表」的映射，并写入 Redis 以及当前实例内存。 <ul><li>推荐使用 Redis Hash，例如：<code>ripple:auth:api-perm:http</code>，Field 为规范化后的 <code>&quot;&lt;METHOD&gt; &lt;PATH&gt;&quot;</code>（如 <code>&quot;GET /users&quot;</code>），Value 为 JSON 数组字符串（如 <code>&quot;[\&quot;user:list\&quot;]&quot;</code>）。</li></ul></li><li>对于 WebSocket 接口，<code>system_api_list.protocol = &quot;1&quot; 且配置 </code>ws_action`，同样需要登记在权限模型中，构建「ws_action → 权限点编码列表」的映射，并写入 Redis 以及当前实例内存。 <ul><li>推荐使用独立的 Hash，例如：<code>ripple:auth:api-perm:ws</code>，Key 或 Field 中以 <code>ws_action</code> 作为索引，Value 为 JSON 数组字符串（如 <code>&quot;[\&quot;chat:send\&quot;]&quot;</code>）。</li></ul></li></ul></li><li>中间件处理每个请求时<strong>只访问本地内存缓存</strong>完成 URL + Method 到权限点列表的解析，不对数据库或 Redis 进行逐请求访问，避免对数据库造成高并发压力。</li><li>当 <code>system_api_list</code>、<code>system_api_perm</code> 或关联关系发生变更时： <ul><li>变更所在 Service 在事务提交后，负责重新计算映射并写回 Redis；</li><li>同时通过 Redis Pub/Sub 发布通知，例如频道 <code>ripple:auth:api-perm:reload</code>，消息体可为变更范围或简单的全量刷新标记；</li><li>各应用实例订阅该频道，收到通知后重新从 Redis（或直接从数据库）加载映射到本地内存中，实现多实例之间的缓存同步。</li></ul></li><li>若某个受保护接口在映射表中查不到任何权限点配置，应视为配置错误： <ul><li>中间件应拒绝该请求并返回明确的业务错误（与文档中“如果一个接口没有绑定权限点，一律抛出错误”保持一致），而不是放行。</li></ul></li><li>一个接口可以绑定多个权限点时，这些权限点之间在鉴权逻辑上为 <strong>OR 关系</strong>： <ul><li>只要当前用户的任一角色对其中任一 <code>permission_code</code> 的 Enforce 结果为 <code>true</code>，即可视为通过该接口的权限校验；不支持通过“一个接口绑定多个权限点”来实现 AND 语义，如需 AND，应拆分接口或在业务层通过额外数据查询和判断实现。</li></ul></li></ul></li><li>与菜单联动（动态策略）： <ul><li>这里的「联动」是指数据同步。<code>sys_role_menu</code> 表用于前端展示菜单树，<code>casbin_rule</code> 表用于后端鉴权。</li><li>任何涉及「角色-菜单」关系变更、「菜单权限编码」变更的操作，都必须在事务中同步刷新 <code>casbin_rule</code> 表中的记录。</li></ul></li></ul></li></ul></li><li>Token 设计： <ul><li>使用 <code>JWT</code> 作为访问令牌与刷新令牌的基础格式，包含但不限于以下 Claim： <ul><li><code>userId</code>：用户 ID；</li><li><code>userName</code>：用户名；</li><li><code>roles</code>：角色编码数组；</li><li><code>jti</code>：Token 唯一标识；</li><li><code>sessionId</code>：会话编号（可选，便于与在线用户记录关联）；</li><li><code>exp</code>：过期时间（UTC 时间戳）；</li><li><code>kid</code>：密钥标识（便于轮换）；</li></ul></li><li>访问令牌与刷新令牌需使用不同的 Claim/受众以便区分两类 Token。</li><li>所有时间 Claim 必须使用 UTC 时间，与数据库 <code>timestamptz</code> 字段保持一致。</li></ul></li><li>安全相关补充： <ul><li>所有密码字段在任何日志、响应、错误信息中均不得以明文或可逆形式出现。</li><li>认证/鉴权失败时，统一返回规范化的业务错误码（<code>2xxx</code> 段），具体分配在实现阶段细化。</li><li>所有与登录、注册、Token 刷新等敏感接口，都应结合 IP/设备信息与速率限制策略，防止暴力破解与滥用。</li><li>Casbin 模型独立放置。</li></ul></li></ul><h4 id="_3-2-2-中间件与请求上下文" tabindex="-1">3.2.2 中间件与请求上下文 <a class="header-anchor" href="#_3-2-2-中间件与请求上下文" aria-label="Permalink to “3.2.2 中间件与请求上下文”">​</a></h4><p>为简化各模块的权限检查与审计，鉴权中间件应在成功解析并验证 Token 后，将以下信息注入请求上下文（例如 Gin 的 <code>Context</code>）：</p><ul><li><code>requestId</code>：来自请求头 <code>X-Request-ID</code>，若不存在则由网关或服务端生成。</li><li><code>userId</code>：当前用户的 ID；未登录时为 <code>guest</code> 用户的虚拟 ID（可为空或特殊值）。</li><li><code>userName</code>：当前用户名。</li><li><code>roles</code>：当前用户角色编码数组。</li><li><code>permissionCodes</code>：用户拥有的 system_api_perm.code 列表（来自角色-菜单-权限点链路）”（可选，视性能策略决定是否预先加载）。</li><li><code>sessionId</code>：当前会话编号，用于在线用户、WebSocket、审计日志关联。</li></ul><p>各业务模块在需要进行细粒度判断时（例如“是否允许操作自己的资源”）可通过上下文获取当前用户 ID 与角色信息，避免重复解析 Token。</p></div></div></main><footer class="VPDocFooter" data-v-d9c38dcc data-v-3ee9435d><!--[--><!--]--><div class="edit-info" data-v-3ee9435d><!----><div class="last-updated" data-v-3ee9435d><p class="VPLastUpdated" data-v-3ee9435d data-v-70e428c2>最后更新于: <time datetime="2025-12-18T13:26:28.000Z" data-v-70e428c2></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-3ee9435d><span class="visually-hidden" id="doc-footer-aria-label" data-v-3ee9435d>Pager</span><div class="pager" data-v-3ee9435d><a class="VPLink link pager-link prev" href="/design-doc.html" data-v-3ee9435d><!--[--><span class="desc" data-v-3ee9435d>Previous page</span><span class="title" data-v-3ee9435d>设计文档</span><!--]--></a></div><div class="pager" data-v-3ee9435d><!----></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"articles_archiso-wifi-laptop.md\":\"B2AOUwOF\",\"articles_babel-in-future.md\":\"CH5cqZUc\",\"articles_backend-rules.md\":\"C1mul3aG\",\"articles_frontend-dev-conventions.md\":\"ORcaGNsA\",\"articles_frontend-naming-conventions.md\":\"BshYNUdS\",\"articles_go-conventions.md\":\"tSRy46Fo\",\"articles_i-choose-avoid.md\":\"CfTfbmhO\",\"articles_index.md\":\"Cst0NQZ5\",\"articles_linux-keep-usb-alive.md\":\"b2nVDqUO\",\"articles_nestjs-dev-conventions.md\":\"BRIi-fSK\",\"articles_oh-frontend.md\":\"Duqa2JPK\",\"articles_rewrite-relative-import-extensions.md\":\"D0_n7eW7\",\"articles_sharp-comment-bun.md\":\"BYVJl9X6\",\"articles_uber-go.md\":\"Dix67vrt\",\"articles_vibe-coding-an-os.md\":\"CPcZYtVd\",\"codes_add-jitter.md\":\"R0r3xtof\",\"codes_array-get-value-by-select-data.md\":\"eXA59KMY\",\"codes_array-sum.md\":\"jXrpe947\",\"codes_biomejs-config.md\":\"Chse87Jw\",\"codes_build-query-string.md\":\"CkanAejy\",\"codes_convert-px-rem.md\":\"wFYLNGTU\",\"codes_eslint-flat-config.md\":\"dpkv4kYE\",\"codes_filter-array-with-index-by-id.md\":\"CNv9UN6x\",\"codes_frontend-gitignore.md\":\"BlKx7VrM\",\"codes_index.md\":\"SUPKpK-6\",\"codes_is-empty.md\":\"Drp-6LD3\",\"codes_search-systemd-shutdown-timeout.md\":\"DfV5zIvN\",\"codes_simple-uid.md\":\"DBK9N-wl\",\"design-doc_index.md\":\"D3l0KUBF\",\"design-doc_packer.md\":\"B5kElKWn\",\"design-doc_ripple.md\":\"DbiwPYwA\",\"index.md\":\"BMsYpxVp\",\"spring_index.md\":\"CotZEMhK\",\"spring_microservice-auth.md\":\"DotXUpaU\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-Hans\",\"dir\":\"ltr\",\"title\":\"Luke Na's Docs\",\"description\":\"Web 文章、资料、代码片段等内容\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"主页\",\"link\":\"/\"}],\"sidebar\":{\"/articles\":[{\"text\":\"简介\",\"link\":\"/articles\"},{\"text\":\"TypeScript\",\"items\":[{\"text\":\"聊下 `rewriteRelativeImportExtensions` 这个 TS 配置项\",\"link\":\"/articles/rewrite-relative-import-extensions\"}]},{\"text\":\"Linux\",\"items\":[{\"text\":\"使用 Systemd 防止移动硬盘休眠\",\"link\":\"/articles/linux-keep-usb-alive\"},{\"text\":\"在只有无线网卡的笔记本上通过 Archiso 安装 Arch Linux\",\"link\":\"/articles/archiso-wifi-laptop\"}]},{\"text\":\"技术杂谈\",\"items\":[{\"text\":\"聊下前端 —— 关于我的职业经历和前端是否会被“取代”的碎碎念\",\"link\":\"/articles/oh-frontend\"},{\"text\":\"原生工具浪潮下 Babel 的定位与未来演进\",\"link\":\"/articles/babel-in-future\"},{\"text\":\"从 Anthropic 收购 Bun 谈起，聊聊 Bun 的败局\",\"link\":\"/articles/sharp-comment-bun\"},{\"text\":\"90% 代码用 AI 写？我拒了 Offer，也拒了所有华而不实的“网红技术”\",\"link\":\"/articles/i-choose-avoid\"}]},{\"text\":\"规范\",\"items\":[{\"text\":\"Node.js 项目开发规范\",\"link\":\"/articles/frontend-dev-conventions\"},{\"text\":\"Node.js 项目风格和命名规范\",\"link\":\"/articles/frontend-naming-conventions\"},{\"text\":\"后端项目开发规范\",\"link\":\"/articles/backend-rules\"},{\"text\":\"NestJS 开发规范\",\"link\":\"/articles/nestjs-dev-conventions\"},{\"text\":\"Go 语言项目开发规范\",\"link\":\"/articles/go-conventions\"},{\"text\":\"Uber Go 风格指南（译）\",\"link\":\"/articles/uber-go\"}]}],\"/codes\":[{\"text\":\"简介\",\"items\":[{\"text\":\"代码片段\",\"link\":\"/codes\"}]},{\"text\":\"配置文件\",\"items\":[{\"text\":\"前端通用 .gitignore\",\"link\":\"/codes/frontend-gitignore\"},{\"text\":\"BiomeJS 配置\",\"link\":\"/codes/biomejs-config\"},{\"text\":\"Eslint 配置\",\"link\":\"/codes/eslint-flat-config\"}]},{\"text\":\"类型判断\",\"items\":[{\"text\":\"isEmpty 判空函数\",\"link\":\"/codes/is-empty\"}]},{\"text\":\"数组\",\"items\":[{\"text\":\"对象数组指定键求和\",\"link\":\"/codes/array-sum\"},{\"text\":\"根据选择数据获取标签\",\"link\":\"/codes/array-get-value-by-select-data\"},{\"text\":\"根据 id 列表从对象数组中过滤出项并返回匹配项和在其在原数组的索引\",\"link\":\"/codes/filter-array-with-index-by-id\"}]},{\"text\":\"对象\",\"items\":[{\"text\":\"将对象转换为 URL 查询字符串\",\"link\":\"/codes/build-query-string\"}]},{\"text\":\"随机\",\"items\":[{\"text\":\"简易版生成 UID 函数\",\"link\":\"/codes/simple-uid\"},{\"text\":\"为给定的延迟时间添加抖动\",\"link\":\"/codes/add-jitter\"}]},{\"text\":\"数据显示\",\"items\":[{\"text\":\"实现 px 和 rem 的互相转换\",\"link\":\"/codes/convert-px-rem\"}]}],\"/design-doc\":[{\"text\":\"简介\",\"items\":[{\"text\":\"设计文档\",\"link\":\"/design-doc\"}]},{\"text\":\"Go\",\"items\":[{\"text\":\"基础设施设计文档\",\"link\":\"/design-doc/ripple.md\"}]}],\"/spring\":[{\"text\":\"简介\",\"link\":\"/spring\"},{\"text\":\"微服务\",\"items\":[{\"text\":\"微服务项目中鉴权逻辑\",\"link\":\"/spring/microservice-auth\"}]}]},\"lastUpdated\":{\"text\":\"最后更新于\",\"formatOptions\":{\"dateStyle\":\"full\",\"timeStyle\":\"medium\"}},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/narukeu\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>